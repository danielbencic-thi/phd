IEEE ROBOTICS AND AUTOMATION LETTERS. PREPRINT VERSION. ACCEPTED FEBRUARY 2021

1

Interleaving Graph Search and Trajectory Optimization for Aggressive Quadrotor Flight
Ramkumar Natarajan1, Howie Choset1 and Maxim Likhachev1

arXiv:2101.12548v2 [cs.RO] 29 Apr 2021

Abstractâ€”Quadrotors can achieve aggressive ï¬‚ight by tracking complex maneuvers and rapidly changing directions. Planning for aggressive ï¬‚ight with trajectory optimization could be incredibly fast, even in higher dimensions, and can account for dynamics of the quadrotor, however, only provides a locally optimal solution. On the other hand, planning with discrete graph search can handle non-convex spaces to guarantee optimality but suï¬€ers from exponential complexity with the dimension of search. We introduce a framework for aggressive quadrotor trajectory generation with global reasoning capabilities that combines the best of trajectory optimization and discrete graph search. Speciï¬cally, we develop a novel algorithmic framework that interleaves these two methods to complement each other and generate trajectories with provable guarantees on completeness up to discretization. We demonstrate and quantitatively analyze the performance of our algorithm in challenging simulation environments with narrow gaps that create severe attitude constraints and push the dynamic capabilities of the quadrotor. Experiments show the beneï¬ts of the proposed algorithmic framework over standalone trajectory optimization and graph search-based planning techniques for aggressive quadrotor ï¬‚ight.
I. I
Quadrotorsâ€™ exceptional agility and ability to track and execute complex maneuvers, ï¬‚y through narrow gaps and rapidly change directions make motion planning for aggressive quadrotor ï¬‚ight an exciting and important area of research [1], [2], [3]. In order to enable such agile capabilities, motion planning should consider the dynamics and the control limits of the robot. The three distinct approaches for motion planning with dynamics are: (a) optimal control techniques, like trajectory optimization [4], [5], [6], (b) kinodynamic variants of sampling based planning [7] and (c) search based planning over lattice graphs [8]. LQR trees explores the combination of sampling methods (i.e. (b)) with trajectory optimization (i.e. (a)) and successfully demonstrates in real-world dynamical systems [9]. However, it is an oï¬„ine method to ï¬ll the entire state space with lookup policies that takes extremely long time to converge even for low-dimensional systems. In part inspired by LQR trees, in this paper, we explore an eï¬€ective approach to combining trajectory optimization (i.e. (a)) with search-based planning (i.e. (c)) to develop an online planner and demonstrate it on a quadrotor performing aggressive ï¬‚ight.
To appreciate the potential of interleaving graph search and trajectory optimization, it is important to understand the tradeoï¬€s. Search-based planning has global reasoning capabilities
Manuscript received: July, 28, 2020; Revised November, 19, 2020; Accepted December, 21, 2021.
This paper was recommended for publication by Editor Jonathan Roberts upon evaluation of the Associate Editor and Reviewersâ€™ comments.
The authors are with The Robotics Institute at Carnegie Mellon University, Pittsburgh, PA 15213, USA {rnataraj, choset, maxim}@cs.cmu.edu
Digital Object Identiï¬er (DOI): see top of this page.

Fig. 1: Inertial (blue, superscript ğ‘Š) and the body ï¬xed frame (red, superscript ğµ) of the quadrotor. Origin of body ï¬xed frame is at the quadrotorâ€™s center of mass. The direction of roll ğœ™, pitch ğœƒ and yaw ğœ“ and the corresponding angular velocities are shown in green.

and has proven successful in solving numerous robot motion planning problems [10], [11]. Despite that, planning for complex dynamical systems using search-based techniques still remains an uncharted area due to the challenge of discretizing an inherently continuous class of systems. For instance, when planning for a quadrotor with attitude constraints, the state space should contain all the pose variables and their ï¬nite derivatives to ensure kinodynamic feasibility. One way to deal with this high-dimensional search is to sparsely discretize the action space which impedes the plannerâ€™s completeness guarantees. Consequently, trajectory optimization is a standard choice to deal with continuous actions and exploit the dynamic capabilities of the system but these are local methods and do not solve the full planning problem [4], [5], [12].

Our contribution in this work is the novel framework called INSAT: INterleaved Search And Trajectory optimization for fast, global kinodynamic planning for aggressive quadrotor ï¬‚ight with completeness guarantees. The key idea behind our framework is (a) to identify a low-dimensional manifold, (b) perform a search over a grid-based graph that discretizes this manifold, (c) while searching the graph, utilize highdimensional trajectory optimization to compute the cost of partial solutions found by the search. As a result, the search over the lower-dimensional graph decides what trajectory optimizations to run and with what seeds, while the cost of solution from the trajectory optimization drives the search in the lowerdimensional graph until a feasible high-dimensional trajectory from start to goal is found.

This paper is structured as follows: we discuss the related

work in Sec. II and summarize the diï¬€erential ï¬‚atness property

of the quadrotor which helps us to lift the low-dimensional

discrete trajectory to high dimension in Sec. III. We formally

deï¬ne our problem in Section IV and describe our proposed

method with its guarantees on completeness in Sec. V. Finally,

we show the experimental results in Sec. VI, and conclude

with future directions in Sec. VII. The code used in this work

is open-sourced at

://

./

93/ .

2

IEEE ROBOTICS AND AUTOMATION LETTERS. PREPRINT VERSION. ACCEPTED FEBRUARY 2021

II. R

W

Polynomial trajectory planning [6] jointly optimizes the pieces of a piecewise polynomial trajectory for ï¬‚at systems [13] in a numerically robust and unconstrained fashion. It is a sequential method that uses a piecewise linear path as a seed for polynomial trajectory generation. Consequently, they do not handle attitude constraints for narrow gaps or perform global reasoning in case a part of the seed plan is invalid. Several prior works have demonstrated aggressive maneuvers for quadrotors that pass through narrow gaps [4], [5], [12] but, instead of solving the planning problem, those works focus on trajectory optimization with given attitude constraints. Those constraints are often hand-picked beforehand or obtained using gap detection algorithms which only works for speciï¬c cases.
Aggressive quadrotor planning for large environments typically involves building a safe corridor [14] such as convex decomposition of the free space [15], [16]. These methods do not deal with attitude constraints and hence there is no guarantee on plannerâ€™s completeness when the robot has to aggressively negotiate a narrow gap. Liuâ€™s work [8], [17] on lattice search with predeï¬ned primitives for aggressive ï¬‚ight is the ï¬rst method that attempts to incorporate quadrotor shape and dynamics in planning for large environments. It uses search-based methods to synthesize a plan over the lattice. However, lattice search suï¬€ers from the curse of dimensionality and their performance signiï¬cantly depends on the choice of discretization for the state and the action space. Barring the interplay of low and high-dimensional search, our work is reminiscent of Theta* [18] as both the methods proceed by rewiring each successor to the best ancestor possible. However, Theta* is a planning algorithm designed speciï¬cally for 2D and 3D grid search and not applicable to higher dimensional planning like ours.
Sampling-based robot motion planning has a rich history owing to their simplicity and scalability to higher dimensions [19], [20]. But for kinodynamic planning, they rely on the â€œsteerâ€ operator which is often not eï¬ƒcient to compute [7]. They also suï¬€er from the narrow passage problem [21], take longer time to converge to a good quality path and have unreliable intermediate path quality [20]. Despite that, sampling-based trajectory optimization methods like LQR trees [9] with very high convergence time have enjoyed success and even been applied to hybrid systems [22]. These methods focus on the conditions for guaranteed execution based on the geometry of the trajectory funnels and the obstacles and even demonstrate it on a spherical quadrotor [23]. However, deriving such relations become extremely hard or almost impossible if the quadrotor is approximated as an ellipsoid.

III. D

F

C

Q

The quadrotor dynamics with four inputs (net thrust and the body moment about each axis) is diï¬€erentially ï¬‚at [24]. In other words, the states and inputs can be written as algebraic functions of the so-called ï¬‚at outputs, ğ‘¥, ğ‘¦, ğ‘§, and ğœ“ (yaw) and their derivatives. However, since the yaw is decoupled and does not aï¬€ect the system dynamics, we do not consider it during planning. The Newtonâ€™s equation of motion governing

the acceleration of center of mass and the angular velocity of

a standard quadrotor in terms of the ï¬‚at outputs are

ğ‘šx = âˆ’ğ‘šğ‘”zğ‘Š + ğ‘“ ğµzğµ

(1)

ï£® ğœ”2 ï£¹ ğğµ = ï£¯ï£¯âˆ’ğœ”1ï£ºï£º =
ï£¯ï£º

1 ğ‘“ğµ

ï£®1 ï£¯
ï£¯0 ï£¯

0 1

0ï£¹

ï£º 0ï£º

Râˆ’1x

ï£º

(2)

ï£¯ ğœ”3 ï£º

ï£¯0 0 0ï£º

ï£°ï£»

ï£°

ï£»

where x is the position vector of the robotâ€™s center of mass

in the inertial frame, ğ‘š is its mass, ğ‘” is the acceleration due

to gravity, R describes the rotation of the body frame ğµ with respect to the inertial frame ğ‘Š, ğğµ and ğ‘“ ğµ are the angular

velocity vector and net thrust in the body-ï¬xed coordinate frame (Fig. 1). zğµ is the unit vector aligned with the axis

of the four rotors and indicates the direction of thrust, while âˆ’zğ‘Š is the unit vector expressing the direction of gravity.

The ï¬‚atness property lets us calculate the quadrotorâ€™s ori-

entation from the ï¬‚at outputs and its derivatives. We make

a useful observation from Eq. 1 that the quadrotor can only

accelerate in the direction of thrust and hence the attitude (roll

and pitch) is constrained given the thrust vector. This constraint

mapping is invertible and hence we can recover the direction

of acceleration from attitude. In Sec. V-A, we will describe

and explicitly derive how the magnitude of acceleration is calculated by getting rid of the free variable ğ‘“ ğµ in Eq. 1.

Following [25], we use triple integrator dynamics with jerk

input for quadrotor planning. Trajectory segments consisting

of three polynomial functions of time, each specifying the

independent evolution of ğ‘¥, ğ‘¦, ğ‘§, is used for quadrotor planning

between two states in the ï¬‚at output space [26], [6], [25].

As the desired trajectory and its derivatives are suï¬ƒcient to

compute the states and control inputs in closed form, they

serve as a simulation of the robotâ€™s motion in the absence

of disturbances. This powerful capability is enabled by diï¬€er-

ential ï¬‚atness that eliminates the need for iterated numerical

integration of equations of motion, or a search over the space

of inputs during each iteration of the planning algorithm.

IV. P

S

Let ğˆ denote the translational variables of the quadrotor

including its position, velocity, acceleration and jerk, ğˆ =

[xT, xË™T, xÂ¨T, xT]T âˆˆ R12. The 3D pose of the quadrotor is given

by the position of its center of mass x = [ğ‘¥, ğ‘¦, ğ‘§]T and orienta-

tion (in Euler angles) ğš¯ = [ğœ™, ğœƒ, ğœ“]T in the inertial frame.

Given

(a)

an initial

state

s0

=

[ğˆT

0,

ğš¯0

T

,

(

ğğµ
0

)

T

,

(

ğœ¶ğµ
0

)T]

T

where ğğµ and ğœ¶ğµ are the angular velocity and angular accel-

eration of the body frame ğµ, (b) a goal region Xğ‘”ğ‘œğ‘ğ‘™, (c) the

planning space X with the obstacles Xğ‘œğ‘ğ‘ , the task is to ï¬nd an optimal trajectory ğˆâˆ— (ğ‘¡) = [xâˆ— (ğ‘¡)T, xË™âˆ— (ğ‘¡)T, xÂ¨âˆ— (ğ‘¡)T, xâˆ— (ğ‘¡)T]T
according to Eq. 3, where xâˆ— (ğ‘¡) âˆˆ X \ Xğ‘œğ‘ğ‘ , ğ‘¡ âˆˆ [0, ğ‘‡] or the

corresponding control inputs uâˆ— (ğ‘¡), ğ‘¡ âˆˆ [0, ğ‘‡]. Xğ‘œğ‘ğ‘  represents

all the conï¬gurations of the robot that are in collision (Sec.

V-D2) with its shape taken into consideration.

For aggressive ï¬‚ight, the dynamical constraints of the

quadrotor in terms of thrust and torques that can be supplied

by the motors have to be satisï¬ed while planning. Using

the diï¬€erential ï¬‚atness property, these control saturation can

be converted to componentwise box constraints on velocity,

acceleration and jerk on each axis independently [27] as

NATARAJAN et al.: INTERLEAVING GRAPH SEARCH AND TRAJECTORY OPTIMIZATION FOR AGGRESSIVE QUADROTOR FLIGHT

3

|xË™ (ğ‘¡)| xË™ ğ‘šğ‘ğ‘¥, |xÂ¨ (ğ‘¡)| xÂ¨ ğ‘šğ‘ğ‘¥, |x(ğ‘¡)| xğ‘šğ‘ğ‘¥. Thus the time-

optimal path-planning for aggressive quadrotor ï¬‚ight can be

cast as the following optimization problem:

âˆ«ğ‘‡

min ğ½ğ‘¡ğ‘œğ‘¡ğ‘ğ‘™ =

x(ğ‘¡) 2 + ğ›¾ğ‘‡

x(ğ‘¡),u(ğ‘¡) ,ğ‘‡

0

s.t. xË™ = ğ¹ (x, u),

x(0) = x0,

(3)

x(ğ‘‡ ) âˆˆ Xğ‘”ğ‘œğ‘ğ‘™,

|xË™ (ğ‘¡)| xË™ ğ‘šğ‘ğ‘¥, |xÂ¨ (ğ‘¡)| xÂ¨ ğ‘šğ‘ğ‘¥, |x(ğ‘¡)| xğ‘šğ‘ğ‘¥

x(ğ‘¡) âˆˆ X \ Xğ‘œğ‘ğ‘ , u âˆˆ U âˆ€ğ‘¡ âˆˆ [0, ğ‘‡]

where ğ¹ and U denote the quadrotor dynamics and the set of all

attainable control vectors, ğ½ğ‘¡ğ‘œğ‘¡ğ‘ğ‘™ is total cost of the trajectory

and ğ›¾ is the penalty to prioritize control eï¬€ort over execution

time ğ‘‡. It is suï¬ƒcient to ï¬nd the optimal trajectory purely in

terms of translational variables as the reminder of state can be

recovered using the results of diï¬€erential ï¬‚atness.

V. M P

FA

F

Our trajectory planning framework consists of two overlapping modules: a grid-based graph search planner and a trajec-

tory optimization routine. These two methods are interleaved

to combine the beneï¬ts of formerâ€™s ability to search non-

convex spaces and solve combinatorial parts of the problem

and the latterâ€™s ability to obtain a locally optimal solution

not constrained to the discretized search space. We provide

analysis (Sec. V-C) and experimental evidence (Sec. VI) that

interleaving provides a superior alternative in terms of quality

of the solution and behavior of the planner than the naive

option of running them in sequence [6].

We begin by providing a brief overview of the polynomial

trajectory optimization setup. This will be followed by the

description of the INSAT framework and how it utilizes graph

search and polynomial trajectory generation. We then analyse

INSATâ€™s guarantees on completeness.

A. Attitude Constrained Joint Polynomial Optimization

To generate a minimum-jerk and minimum-time trajectory,

the polynomial generator should compute a thrice diï¬€erentiable

trajectory that guides the quadrotor from an initial state to

a partially deï¬ned ï¬nal state by respecting the spatial and

dynamic constraints while minimizing the cost function given

in Eq. 3. For quadrotors, it is a common practice to con-

sider triple integrator dynamics and decouple the trajectory

generation [25], [8] into three independent problems along

each axis. However, for attitude constrained ï¬‚ight, although

the dynamic inversion provided by the ï¬‚atness property aids

in determining the direction of acceleration from the desired

attitude, the corresponding magnitude cannot be computed by

axis independent polynomial optimization. We note from Eq. 1 that the thrust supplied by the motors ğ‘“ ğµ is a free variable

which can be eliminated to deduce a constraint relationship

between the components of the acceleration vector x and the

direction of thrust in body frame zğµ as follows

xğ‘¥ = xğ‘¦ = xğ‘§ âˆ’ ğ‘”

(4)

zğµğ‘¥ zğµğ‘¦

zğ‘§ğµ

where xğ‘– and zğ‘–ğµ are the axis-wise components of acceleration

and thrust vector. Rearranging the terms in Eq. 4 provides a

linear constraint on acceleration independent of the thrust

ï£®âˆ’zğµğ‘¦ zğµğ‘¥ 0 ï£¹ ï£®xğ‘¥ï£¹ ï£® 0 ï£¹

ï£¯ï£¯âˆ’zğ‘§ğµ

0

zğµğ‘¦

ï£º ï£º

ï£¯ï£º ï£¯xğ‘¦ ï£º

=

ï£¯ï£¯ğ‘”zğµğ‘¥

ï£º ï£º

(5)

ï£¯ ï£¯0

âˆ’zğ‘§ğµ

zğµğ‘¦

ï£º ï£º

ï£¯ï£º ï£¯xğ‘§ ï£º

ï£¯ï£¯ğ‘”zğµğ‘¦

ï£º ï£º

ï£°

ï£»ï£° ï£» ï£° ï£»

W

d

Wx = d

(6)

We incorporate the constraint derived above in the joint

polynomial optimization method introduced in [6] to ï¬nd a

sequence of polynomials through a set of desired attitude

constrained waypoints. Thus, the ï¬rst term of the cost function

in Eq. 3 can be transformed into product of coeï¬ƒcients of ğ‘€

polynomials and their Hessian with respect to ğ‘ coeï¬ƒcients

per polynomial thereby forming a quadratic program (QP)

âˆ«ğ‘‡

ğ½ğ‘ğ‘œğ‘›ğ‘¡ğ‘Ÿğ‘œğ‘™ =

x(ğ‘¡) 2 = pTHp

(7)

0
where pâˆˆ Rğ‘€ ğ‘ represents all the polynomial coeï¬ƒcients

grouped together and H is the block Hessian matrix with

each block corresponding to a single polynomial. Note that

the integrand encodes the sequence of polynomial segments as

opposed to just one polynomial and each block of the Hessian

matrix is a function of time length of the polynomial segment.

We omit the details for brevity and defer the reader to [6]

for a comprehensive treatment. Following [6], the requirement

to satisfy the position constraints and derivative continuity is

achieved by observing that the derivatives of the trajectory

are also polynomials whose coeï¬ƒcients depend linearly on the

coeï¬ƒcients of the original trajectory. In our case, in addition to

position and continuity constraints we have to take the attitude

constraints into account via acceleration using Eq. 6.

ï£®xï£¹

Ap

=

ï£¯ï£º ï£¯xï£º

ï£¯ï£º

=â‡’

Ap =

b Wâˆ’1d

=â‡’ p = Aâˆ’1c

(8)

ï£¯xï£º

ï£°ï£»

c

where the matrix A maps the coeï¬ƒcients of the polynomials

to their endpoint derivatives and b contains all other derivative

values except acceleration which is obtained using Eq. 6. Using

Eq. 8 in Eq. 7

ğ½ğ‘ğ‘œğ‘›ğ‘¡ğ‘Ÿ ğ‘œğ‘™ = cTAâˆ’THAâˆ’1c

(9)

Note that due to the interdependent acceleration constraint

(Eq. 5) imposed at the polynomial endpoints, we lost the

ability to solve the optimization independently for each axis.

Nevertheless, the key to the eï¬ƒciency of our approach lies in

the fact that solving a QP like Eq. 7 subject to linear constraints

in Eq. 8 or in their unconstrained format in Eq. 9 is incredibly

fast and robust to numerical instability. Thus the total jerk and

time cost ğ½ğ‘¡ğ‘œğ‘¡ğ‘ğ‘™ to be minimized becomes

ğ‘€

ğ½ğ‘¡ğ‘œğ‘¡ ğ‘ğ‘™

=

cTAâˆ’THAâˆ’1c

+

ğ›¾

âˆ‘ï¸ ğ‘‡ğ‘–

(10)

ğ‘–=1 ğ½ğ‘ğ‘œğ‘›ğ‘¡ğ‘Ÿ ğ‘œğ‘™

ğ½ğ‘¡ ğ‘– ğ‘šğ‘’
where ğ‘‡ğ‘– expresses the time length of the ğ‘–th polynomial. As

mentioned before, the Hessian depends on the choice of time

length of the polynomial segment and hence the overall cost is

minimized by running a gradient descent on ğ‘‡ğ‘– and evaluating

ğ½ğ‘ğ‘œğ‘›ğ‘¡ğ‘Ÿğ‘œğ‘™ corresponding to a particular ğ‘‡ğ‘–.

4

IEEE ROBOTICS AND AUTOMATION LETTERS. PREPRINT VERSION. ACCEPTED FEBRUARY 2021

B. INSAT: Interleaving Search And Trajectory Optimization

To plan a trajectory that respects system dynamics and

controller saturation, and simultaneously reason globally over

large non-convex environments, it is imperative to maintain the

combinatorial graph search tractable. To this end, we consider a low-dimensional space Xğ¿ (5D) comprising {xT , ğœ™, ğœƒ}. The
discrete graph search runs in Xğ¿ which typically contains

variables of the state whose domain is non-convex. It then

seeds the trajectory optimization, such as the one in Sec. V-A, in the high-dimensional space Xğ» (12D) comprising {xT, xË™T, xÂ¨T, xT}, to in turn obtain a better estimate of the cost-to-come

value of a particular state for the graph search. The subscripts

ğ¿ and ğ» refer to the low and high-dimensional states. Alg. 1 presents the pseudocode of INSAT. Let sğ¿ âˆˆ Xğ¿
and sğ» âˆˆ Xğ» be the low-dimensional and high-dimensional

state. The algorithm takes as input the high-dimensional start

and

goal

states

sğ‘ ğ»ğ‘¡ ğ‘ğ‘Ÿğ‘¡ ,

ğ‘”ğ‘œğ‘ğ‘™
sğ»

and

recovers

their

low-dimensional

counterparts

sğ‘ ğ¿ğ‘¡

ğ‘ğ‘Ÿ

ğ‘¡

,

ğ‘”ğ‘œğ‘ğ‘™
sğ¿

(lines

20-22).

The

low-dimensional

free space Xğ¿ \ Xğ‘œğ‘ğ‘  is discretized to build a graph Gğ¿ to

search. To search in Gğ¿, we use weighted A* (WA*)[28] which

maintains a priority queue called OPEN that dictates the order

of expansion of the states and the termination condition based

on K ( ğ¿) value (lines 1, 25). Alg. 1 maintains two functions: cost-to-come ğ‘”(sğ¿) and a heuristic â„(sğ¿). ğ‘”(sğ¿) is the cost of the current path from the start state to sğ¿ and â„(sğ¿) is an

underestimate of the cost of reaching the goal from sğ¿. WA* initializes OPEN with sğ‘ ğ¿ğ‘¡ğ‘ğ‘¡ğ‘’ (line 24) and keeps track of the expanded states using another list called CLOSED (line 29).

A graphical illustration of the algorithm is provided in Fig.

2. Each time the search expands a state sğ¿, it removes sğ¿ from

OPEN and generates the successors as per the discretization

(lines 26-28). For every low-dimensional successor nğ¿, we

solve a trajectory optimization problem described in Sec. V-A

to ï¬nd a corresponding high-dimensional trajectory from start

to goal via nğ» (lines 6-7, Fig 2). Note that the trajectory op-

timization is performed in the space of translational variables

but nğ¿ speciï¬es an attitude requirement. So prior to trajectory

optimization, we utilize the diï¬€erential ï¬‚atness property to

transform the attitude of the quadrotor to an instantaneous direction and magnitude of acceleration nxğ» to be satisï¬ed (line 5, Eq. 5). The trajectory optimization output nğ» (ğ‘¡) is checked

for collision and control input feasibility (line 8, Sec. V-D). If the optimized trajectory nğ» (ğ‘¡) is in collision or infeasible (Fig.

2-Left), the algorithm enters the repair phase (lines 10-17).

The repair phase is same as the ï¬rst call to the optimizer
except that instead of the start state sğ‘ ğ»ğ‘¡ğ‘ğ‘Ÿğ‘¡ , we iterate over the waypoints mğ» (line 11) of the parent stateâ€™s trajectory sğ» (ğ‘¡)

in order (lines 11-14, Fig. 2-Center). It has to be noted that

the computational complexity of trajectory optimization QP is

same for both the initial attempt and the repair phase as the sequence of polynomials from sğ‘ ğ»ğ‘¡ğ‘ğ‘Ÿğ‘¡ to mğ» is unmodiï¬ed. Upon ï¬nding the state mğ» which enables a high-dimensional

feasible trajectory from start to goal via nğ» , the full trajectory nğ» (ğ‘¡) is constructed by concatenating mğ» (ğ‘¡) up to mğ» and the newly repaired trajectory, rğ» (ğ‘¡), starting from mğ» (line

15). The ï¬nal trajectory is obtained by warm starting the optimization with the trajectory nğ» (ğ‘¡) as the seed and relaxing

Algorithm 1 INSAT

1: procedure K (sğ¿) 2: return ğ‘”(sğ¿) + ğœ– âˆ— â„(sğ¿)

3: procedure G

T

(sğ¿, nğ¿)

4: zğµ = [ğ‘ ğ‘–ğ‘›(nğ¿ğœƒ ), âˆ’ğ‘ğ‘œğ‘ (nğ¿ğœƒ )ğ‘ ğ‘–ğ‘›(nğ¿ğœ™), ğ‘ğ‘œğ‘ (nğ¿ğœ™)ğ‘ğ‘œğ‘ (nğ¿ğœƒ )]

5:

nxğ» = Wâˆ’1d

âŠ² Diï¬€erential ï¬‚atness Eq. 5

6:

c

=

[(sğ‘ ğ»ğ‘¡ ğ‘ğ‘Ÿğ‘¡ )T,

(nğ»

)T,

(

ğ‘”ğ‘œ
sğ»

ğ‘ğ‘™

)T

]

T

âŠ² Eq. 8

7: nğ» (ğ‘¡) = ğ‘‡ğ‘Ÿğ‘ ğ‘— ğ‘’ğ‘ğ‘¡ğ‘œğ‘Ÿ ğ‘¦ğ‘‚ ğ‘ğ‘¡ğ‘–ğ‘šğ‘–ğ‘§ğ‘’ğ‘Ÿ (c)

âŠ² Eq. 10

8: if nğ» (ğ‘¡nğ» ).ğ¼ ğ‘ ğ¶ğ‘œğ‘™ğ‘™ğ‘–ğ‘ ğ‘–ğ‘œğ‘›ğ¹ğ‘Ÿğ‘’ğ‘’()

âŠ² Sec. V-D2

nğ» (ğ‘¡nğ» ).ğ¼ ğ‘ ğ¼ğ‘›ğ‘ğ‘¢ğ‘¡ğ¹ğ‘’ğ‘ğ‘ ğ‘–ğ‘ğ‘™ğ‘’() then âŠ² Sec. V-D1

9:

return nğ» (ğ‘¡)

10: else

11:

for mğ» âˆˆ ğ‘Š ğ‘ğ‘¦ ğ‘ğ‘œğ‘–ğ‘›ğ‘¡ğ‘ (sğ» (ğ‘¡)) do

12:

c = [(mğ» )T, (nğ» )T, (sğ‘”ğ»ğ‘œğ‘ğ‘™)T]T

âŠ² Eq. 8

13:

rğ» (ğ‘¡) = ğ‘‡ğ‘Ÿğ‘ ğ‘— ğ‘’ğ‘ğ‘¡ğ‘œğ‘Ÿ ğ‘¦ğ‘‚ ğ‘ğ‘¡ğ‘–ğ‘šğ‘–ğ‘§ğ‘’ğ‘Ÿ (c)

âŠ² Eq. 10

14:

if rğ» (ğ‘¡nğ» ).ğ¼ ğ‘ ğ¶ğ‘œğ‘™ğ‘™ğ‘–ğ‘ ğ‘–ğ‘œğ‘›ğ¹ğ‘Ÿğ‘’ğ‘’()

âŠ² Sec. V-D2

rğ» (ğ‘¡nğ» ).ğ¼ ğ‘ ğ¼ğ‘›ğ‘ğ‘¢ğ‘¡ğ¹ğ‘’ğ‘ğ‘ ğ‘–ğ‘ğ‘™ğ‘’() then âŠ² Sec. V-D1

15:

nğ» (ğ‘¡) = ğ¶ğ‘œğ‘›ğ‘ğ‘ğ‘¡ğ‘’ğ‘›ğ‘ğ‘¡ğ‘’(mğ» (ğ‘¡), rğ» (ğ‘¡))

16:

ğ‘…ğ‘’ğ‘™ğ‘ğ‘¥ğ¶ğ‘œğ‘›ğ‘ ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›ğ‘¡ğ‘ ğ´ğ‘›ğ‘‘ğ‘Šğ‘ğ‘Ÿğ‘šğ‘†ğ‘¡ğ‘ğ‘Ÿğ‘¡(nğ» (ğ‘¡))

17:

return nğ» (ğ‘¡)

18: return Tunnel traj. w/ discrete âˆ cost âŠ² Sec. V-C

19: procedure M

(sğ‘ ğ»ğ‘¡

ğ‘ğ‘Ÿ

ğ‘¡

,

ğ‘”ğ‘œğ‘ğ‘™
sğ»

)

20:

(sğ‘ ğ¿ğ‘¡ ğ‘ğ‘Ÿğ‘¡ )x = (sğ‘ ğ»ğ‘¡ ğ‘ğ‘Ÿğ‘¡ )x; (sğ‘”ğ¿ğ‘œğ‘ğ‘™)x = (sğ‘”ğ»ğ‘œğ‘ğ‘™)x

21: (sğ‘ ğ¿ğ‘¡ğ‘ğ‘Ÿğ‘¡ ) ğœ™, ğœƒ = Obtain from (sğ‘ ğ»ğ‘¡ğ‘ğ‘Ÿğ‘¡ )x

22: (sğ‘”ğ¿ğ‘œğ‘ğ‘™) ğœ™, ğœƒ = Obtain from (sğ‘”ğ»ğ‘œğ‘ğ‘™)x

23: âˆ€sğ¿, ğ‘”(sğ¿) = âˆ; ğ‘”(sğ‘ ğ¿ğ‘¡ğ‘ğ‘Ÿğ‘¡ ) = 0

24: Insert sğ‘ ğ¿ğ‘¡ğ‘ğ‘Ÿğ‘¡ in OPEN with K (sğ‘ ğ¿ğ‘¡ğ‘ğ‘Ÿğ‘¡ )

25:

while K

ğ‘”ğ‘œğ‘ğ‘™
(sğ¿ )

<

âˆ

do

26:

sğ¿ = OPEN.ğ‘ğ‘œ ğ‘()

âŠ² Eq. 1 âŠ² Eq. 1

27:

for sğ¿ âˆˆ ğ‘†ğ‘¢ğ‘ğ‘(sğ¿) do

28:

nğ¿ = ğ‘†ğ‘œ ğ‘“ ğ‘¡ğ¶ğ‘œğ‘ğ‘¦(sğ¿)

29:

if nğ¿ âˆˆ CLOSED then

30:

nğ¿ = ğ·ğ‘’ğ‘’ ğ‘ğ¶ğ‘œ ğ‘ğ‘¦(sğ¿); ğ‘”(nğ¿) = âˆ âŠ² Sec. V-C

31:

nğ» (ğ‘¡) = G

T

(sğ¿, nğ¿)

32:

if nğ» (ğ‘¡).ğ¼ ğ‘ ğ¶ğ‘œğ‘™ğ‘™ğ‘–ğ‘ ğ‘–ğ‘œğ‘›ğ¹ğ‘Ÿğ‘’ğ‘’()

âŠ² Sec. V-D2

nğ» (ğ‘¡).ğ¼ğ‘ ğ¼ğ‘›ğ‘ğ‘¢ğ‘¡ğ¹ğ‘’ğ‘ğ‘ ğ‘–ğ‘ğ‘™ğ‘’() then âŠ² Sec. V-D1

33:

ğ‘”

(

ğ‘”ğ‘œğ‘ğ‘™
ğ‘ 

)

ğ¿

=

ğ½ğ‘¡ğ‘œğ‘¡ ğ‘ğ‘™ (nğ»

(ğ‘¡))

âŠ² Eq. 3

ğ‘”ğ‘œğ‘ğ‘™

34:

Insert/Update nğ¿ in OPEN with K (ğ‘ ğ¿ )

35:

if ğ½ğ‘¡ğ‘œğ‘¡ğ‘ğ‘™ (nğ» (ğ‘¡nğ» )) < ğ‘”(nğ¿) then

âŠ² Eq. 3

36:

ğ‘”(nğ¿) = ğ½ğ‘¡ğ‘œğ‘¡ğ‘ğ‘™ (nğ» (ğ‘¡nğ» ))

âŠ² Eq. 3

37:

Insert/Update nğ¿ in OPEN with K (nğ¿)

all the waypoint and derivative constraints (Fig. 2-Right)

until convergence or trajectory becoming infeasible, whichever

occurs ï¬rst. We remark that, within G

T

(),

the trajectory is checked for collision and feasibility only until

the waypoint nğ» indicated by time ğ‘¡nğ» (lines 8, 14) although

the trajectory connects all the way from start to goal via nğ» .

The validity of the full trajectory is checked in M () (line

32) to be considered as a potential goal candidate (line 32-34).

C. Completeness Analysis of INSAT

We import the notations Xğ‘œğ‘ğ‘ , Gğ¿ from V-B. Gğ¿ =

(Vğ¿, Eğ¿) where Vğ¿ and Eğ¿ are set of vertices and edges,

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ¿

=

Xğ¿

\ Xğ‘œğ‘ğ‘ ,

ğ‰G

be

any

path

in

Gğ¿ ,

ğ‰ğ¿ (ğ‘¡)

be

the

low-dimensional trajectory and ğ‰ğ» (ğ‘¡) be the high-dimensional

trajectory that is snap continuous.

NATARAJAN et al.: INTERLEAVING GRAPH SEARCH AND TRAJECTORY OPTIMIZATION FOR AGGRESSIVE QUADROTOR FLIGHT

5

Fig. 2: Graphical illustration of the G

T

() function of INSAT (Alg 1). Here the state sğ¿ is expanded and a trajectory is

optimized for its successor nğ¿. LEFT: At ï¬rst, the optimizer tries to ï¬nd a trajectory directly from start to goal via nğ» (nğ¿â€™s high-dimensional

counterpart) as shown in red (lines 6-7). CENTER: If the portion of the trajectory from the ï¬rst attempt up to nğ¿ is input infeasible or

in collision (as in LEFT), then instead of the start state the earliest possible waypoint mğ» (mğ¿â€™s high-dimensional counterpart) on the high-dimensional trajectory sğ» (ğ‘¡) is selected and a new trajectory segment is incrementally optimized (shown in red) as in lines 11-14.

RIGHT: Once a set of collision free and feasible trajectory segments are found, we reï¬ne the trajectory by relaxing all the waypoint and

derivative constraints (convergence shown with diï¬€erent shades of red). Note that this stage can consist of several polynomials being jointly

optimized, however, the convergence is extremely fast due to warm starting (line 16).

Assumption

(AS):

If

there

exists

ğ‰ğ¿ (ğ‘¡)

âˆˆ

Xğ‘“
ğ¿

ğ‘Ÿ ğ‘’ğ‘’

then

there

18). The tunnel trajectory between mğ‘–ğ» and nğ‘–ğ»+1 (i) is collision-

exists a corresponding path ğ‰G in Gğ¿

free under AS (ii) satisï¬es the boundary pose and derivative

ğ‰G = {(ğ‘£, ğ‘£ ) | ğ‘£, ğ‘£

âˆˆ

Vğ¿ ,

(ğ‘£,

ğ‘£

)

âˆˆ

Eğ¿,

T

(ğ‘£,

ğ‘£

)

âŠ†

Xğ‘“
ğ¿

ğ‘Ÿ ğ‘’ğ‘’ }

where T (ğ‘£, ğ‘£ ) is the tunnel around the edge (ğ‘£, ğ‘£ ) (Fig. 3).

Theorem 1.

âˆƒ

ğ‰ğ»

(ğ‘¡)

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

=â‡’

âˆƒ

ğ‰ğ¿ (ğ‘¡)

âˆˆ

Xğ‘“
ğ¿

ğ‘Ÿ ğ‘’ğ‘’

Proof. Using quadrotorâ€™s diï¬€erential ï¬‚atness all the variables

of Xğ¿ can be recovered from the variables in Xğ» . So the map

Mğ»
ğ¿

:

Xğ»

â†¦â†’

Xğ¿

is

a

surjection.

But

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

=

{xğ»

âˆˆ

Xğ»

|

M

ğ» ğ¿

(xğ»

)

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’}
ğ¿

and

hence

the

map

M ğ» ( ğ‘“ ğ‘Ÿğ‘’ğ‘’)
ğ¿

:

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

â†¦â†’

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ¿

is

also

a

surjection.

constraints (iii) snap continuous. The existence of such a tunnel

trajectory can be shown using trigonometric bases but it is

beyond

the

scope

of

this

proof.

The

â€œbase

caseâ€

of

Gğ‘– , ğ‘–
ğ¿

=

0

with

1

node

(sğ‘ ğ¿ğ‘¡ ğ‘ğ‘Ÿğ‘¡ )

is

collision-free

sğ‘ ğ»ğ‘¡ ğ‘ğ‘Ÿğ‘¡ (ğ‘¡)

âˆˆ

Xğ‘“
ğ»

ğ‘Ÿ

ğ‘’ğ‘’

.

And

INSAT

ï¬nds

ğ‰ğ‘–+1 (ğ‘¡)
ğ»

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

even

at

(ğ‘– + 1)th

step.

Hence,

INSAT is a provably complete algorithm.

D. Trajectory Feasibility
To plan for aggressive trajectories in cluttered environments, we approximate the shape of the quadrotor as an ellipsoid to

Theorem

2

(Completeness).

If

âˆƒ

ğ‰ğ» (ğ‘¡)

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’,
ğ»

then

INSAT

capture attitude constraints and check for collision. During a

is guaranteed to ï¬nd a ğ‰ (ğ‘¡) âˆˆ X ğ‘“ ğ‘Ÿğ‘’ğ‘’.

state expansion, once the high-dimensional polynomial trajec-

ğ»

ğ»

tory is found from the start to goal via a successor, it is checked

for any violation of dynamics and control input (thrust and

angular velocity) limits. 1) Input Feasibility: We use a recursive strategy introduced

in [27] to check jerk input trajectories for input feasibility

by binary searching and focusing only on the parts of the

polynomial that violate the input limits. The two control inputs

to the system are thrust and the body rate in the body frame.

Fig. 3: Part of the high-dimensional trajectory nğ» (ğ‘¡) from sğ‘ ğ¿ğ‘¡ğ‘ğ‘Ÿğ‘¡ to
ğ‘”ğ‘œğ‘ğ‘™
sğ¿ via the expanded node mğ¿ and its successor nğ¿. The portion of nğ» (ğ‘¡) between mğ¿ and nğ¿ is guaranteed to lie within the tunnel
(yellow) formed by mğ¿ and nğ¿ and is called as tunnel trajectory.

For checking thrust feasibility, the maximum thrust along each axis is calculated independently from acceleration (Eq. 1), by performing root-ï¬nding on the derivative of the jerk input polynomial trajectory. The maximum/minimum value among all the axes is used to check if it lies within the thrust limits.

Proof. Inference (IN): If AS holds, it is enough to search Gğ¿

instead

of

Xğ‘“
ğ¿

ğ‘Ÿ ğ‘’ğ‘’
.

Then

from

Theorem.

1

we

can

deduce

that

there

exists

a

ğ‰G

in

Gğ¿

if

âˆƒ

ğ‰ğ» (ğ‘¡)

âˆˆ

Xğ‘“
ğ»

ğ‘Ÿ

ğ‘’ğ‘’

.

Thus to prove the completeness of INSAT, we have to show

that

Alg.

1

ï¬nds

a

ğ‰ (ğ‘¡)
ğ»

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

for

any

ğ‰G

in

Gğ¿

(i.e

converse of IN). We prove by induction. At ğ‘–th step of INSAT,

let

Gğ‘–
ğ¿

=

(Vğ‘– , Eğ‘– )
ğ¿ğ¿

be

the

low-dimensional

graph

for

which

there

exists

a

ğ‰ğ‘– (ğ‘¡)
ğ»

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

from

sğ‘ ğ¿ğ‘¡ ğ‘ğ‘Ÿ ğ‘¡

to

any

sğ‘–ğ¿

âˆˆ

Vğ‘–
ğ¿

.

The induction is to prove that, at (ğ‘– + 1)th step, after adding

any

number

of

nodes

to

get

Gğ‘–+1
ğ¿

=

( V ğ‘–+1 ,
ğ¿

E

ğ‘–+1 ğ¿

),

INSAT

is

guaranteed

to

ï¬nd

ğ‰ğ‘–+1 (ğ‘¡)
ğ»

âˆˆ

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ»

from

sğ‘ ğ¿ğ‘¡ ğ‘ğ‘Ÿ ğ‘¡

to

every

sğ‘–ğ¿+1

âˆˆ

Vğ¿ğ‘–+1.

Let

mğ‘–ğ¿

âˆˆ

Vğ‘–
ğ¿

be

the

node

expanded

at

(ğ‘– + 1) th

step

from

Gğ‘–
ğ¿

to

generate

a

successor

nğ‘–ğ¿+1

âˆˆ

V ğ‘–+1
ğ¿

and

the

graph

Gğ¿ğ‘–+1.

We

know

that

mğ‘–ğ»

(ğ‘¡)

âˆˆ

Xğ‘“
ğ»

ğ‘Ÿ

ğ‘’ğ‘’

.

So

even

if

the

basic

(lines

6-9)

and

the repair (lines 10-17) phases fail (Sec. V-B), Alg. 1 falls back

to ï¬nding the tunnel trajectory to concatenate with mğ‘–ğ» (ğ‘¡) (line

For body rate, its magnitude can be bounded as a function of the jerk and thrust (Eq. 2). Using this relation, we calculate the body rate along the trajectory and check if it entirely lies within the angular velocity limits. Note that, in the implementation, these two feasibility tests are done in parallel.
2) Collision Checking: We employ a two level hierarchical collision checking scheme. The ï¬rst level checks for a conservative validity of the conï¬guration and reï¬nes for an accurate collision check only if the ï¬rst level fails. In the ï¬rst level, we approximate the robot as a sphere and inï¬‚ate the occupied cells of the voxel grid with its radius. This lets us treat the robot as a single cell and check for collision in cells along the trajectory. The second level follows the ellipsoid based collision checking that takes the actual orientation of the quadrotor into account [8]. By storing the points of the obstacle pointcloud in a KDtree, we are able to crop a subset of the points and eï¬ƒciently check for collisions only in the neighborhood of the robot.

6

IEEE ROBOTICS AND AUTOMATION LETTERS. PREPRINT VERSION. ACCEPTED FEBRUARY 2021

(a) Side views. LEFT: #Walls: 2, #Holes/wall: 1. CENTER: #Walls: 3, #Holes/wall: 1. RIGHT: #Walls: 4, #Holes/wall: 11

(b) L&R side views. LEFT: #Walls: 2, #Holes/wall: 11. CENTER: #Walls: 3, #Holes/wall: 11. RIGHT: Velocity magnitude

Fig. 4: Visualization of trajectory planned by the proposed method in the walls and windows environment. The environment consists of

parallel walls with narrow holes (windows) smaller than the size of the quadrotor. The trajectory is represented as a sequence of ellipsoid

which approximates the quadrotorâ€™s shape to plan in attitude constrained environments. The color gradient from green to red expresses the

magnitude of instantaneous velocity while the arrows along the trajectory denote the magnitude and direction of acceleration. The dynamically

stable agile behavior of the planner is analyzed in Sec. VI-A.

#Walls 2 3

#Windows per wall
1
5
10 1 5 10

Wall gap (m)
5 9 5 9 5 9 5 5 5

Planning Time (s)

INSAT 19.37 Â± 17.34 29.76 Â± 28.41 46.58 Â± 49.76 22.07 Â± 38.89 19.13 Â± 21.81 30.56 Â± 24.08 83.33 Â± 68.54
62 Â± 80.97 18.7 Â± 18.9

Base A 122.5 Â± 88.44 180.47 Â± 93.22 97.15 Â± 70.01 77.64 Â± 58.8 66.62 Â± 56.51 60.81 Â± 43.66 112.33 Â± 87.24 224.60 Â± 309.67 59.76 Â± 56.73

Success Rate (%)

INSAT Base A

100

36

100

24

100

100

100

100

100

100

100

100

100

24

100

100

100

100

Solution Cost (Ã—105)

INSAT Base A

3.7

7.18

5.5

7.48

6

6.16

5.5

6.9

4.21

6.9

4.3

6.14

8.69

9.38

8

7.3

5.01

6.99

Execution Time (s)

INSAT 9.12 Â± 1.04 9.42 Â± 1.54 6.93 Â± 1.89
8.88 Â± 2 9.45 Â± 1.42 6.87 Â± 1.62 11.5 Â± 3.21 9.88 Â± 1.66 8.83 Â± 1.84

Base A 10.4 Â± 1.18 10.81 Â± 1.71 8.97 Â± 2.25 9.49 Â± 2.58 9.19 Â± 2.53 8.45 Â± 1.69 13.7 Â± 2.74 10.8 Â± 2.91 9.84 Â± 2.15

Map
Willow Garage (2.5D) Willow Garage (3D) MIT Stata Center (3D)

Planning Time (s)

INSAT 40.05 Â± 77.09 57.64 Â± 97.24
5 Â± 7.18

Base-A 18.73 Â± 46.7 89.8 Â± 88.31 83.2 Â± 91.94

Base-B 2.55 Â± 1.18 6.53 Â± 2.49 3.94 Â± 1.2

Success Rate (%)

INSAT Base-A Base-B

100

100

6

100

100

10

100

14

32

Solution Cost (Ã—105)

INSAT

Base-A

Base-B

3.33 Â± 4.92 3.73 Â± 2.54 4.34 Â± 1.1

5 Â± 5.27 1.56 Â± 0.91 7.38 Â± 2.67

6.68 Â± 7.65 3.44 Â± 2.33 2.24 Â± 0.88

Execution Time (s)

INSAT 14.5 Â± 6.14 10.11 Â± 6.8 7.12 Â± 3.44

Base-A 7.78 Â± 5.33 3.21 Â± 1.4 5.7 Â± 3.34

Base-B 2.54 Â± 2 4.5 Â± 1.78 7.7 Â± 2.93

TABLE I: Comparison of INSAT with search-based planning for aggressive SE(3) ï¬‚ight (Base-A) [8] and polynomial trajectory planning (Base-B) [6]. The top table displays the average and standard deviation of the results for walls and windows environment and the bottom table for indoor oï¬ƒce environment. Note that INSAT consistently outperforms the baselines across diï¬€erent types of environments.

VI. E

R

polynomial trajectory planning (Base-B) [6]. We used the

We evaluate the empirical performance of INSAT in sim- AscTec Hummingbird quadrotor [30] in the Gazebo simulator ulation against two baselines in two types of environments: [31] as our testing platform. All the methods are implemented 1) a walls and windows environment that mimics an array of in C++ on a 3.6GHz Intel Xeon machine.

narrowly spaced buildings each containing several windows smaller than the radius of the quadrotor and 2) a cluttered A. Walls and Windows Environment indoor oï¬ƒce environment, namely Willow Garage and MIT For the walls and windows environment, we randomly

Stata Center [29] maps. Together the environments convey a generated several scenarios with arbitrary number of parallel

story of a quadrotor aggressively ï¬‚ying through several tall walls where each wall contains random number of windows

raised oï¬ƒce buildings. The baseline methods include search- (gaps smaller than quadrotorâ€™s radius). The goal of the planner

based planning for aggressive SE(3) ï¬‚ight (Base-A) [8] and is to generate a trajectory to ï¬‚y from one end of the parallel

NATARAJAN et al.: INTERLEAVING GRAPH SEARCH AND TRAJECTORY OPTIMIZATION FOR AGGRESSIVE QUADROTOR FLIGHT

7

B. Indoor Oï¬ƒce Environment

(a) Willow Garage oï¬ƒce environment
(b) MIT Stata Center Fig. 5: INSAT in indoor oï¬ƒce environments in 3D mode. Trajectories are expressed in the same format as Fig. 4

We also tested INSAT on the same maps and planning dimensions reported in the baseline papers i.e maps of Willow Garage (2.5D [8] and 3D) and MIT Stata Center (3D) [6]. These are large, cluttered, oï¬ƒce environments that contain a number of narrow gaps smaller than the size of quadrotor. The ï¬nal trajectory from one example is shown in Fig. 5 and the statistics are provided in the bottom half of Table. I. Willow Garage map has tight spaces and high obstacle density but uniform obstacle distribution along its height compared to the MIT map that has scattered obstacles with varying distribution. Thus, Base-B performs well only in the MIT map as it does not necessitate attitude constrained planning.
From the bottom half of Table I we see that INSAT has the highest success rate. For the baselines, we used the same parameters supplied by the authors. In 2.5D planning, BaseA is faster than INSAT as it has a low branching factor with precomputed motion primitives. However, this diï¬€erence vanishes in 3D because of exponential complexity with longer times spent to escape local minimas in Base-A and relatively faster speeds of polynomial trajectory generation in INSAT. The parameters that determine INSATâ€™s performance including planning time, continuity and obeying dynamic constraints are:

walls to the other by negotiating the windows and satisfying their corresponding attitude constraints. Note that the planner also has to ï¬gure out the right topology for the solution, i.e., the sequence of windows it can ï¬‚y through to get to its goal. For this environment, we compared only against Base-A [8] as the other baseline (Base-B) [6] does not explicitly handle attitude constraints needed to plan in these scenarios and therefore had a very low success rate.
The planned trajectory from INSAT is visualized (Fig. 4) as a sequence of ellipsoids approximating the shape of quadrotor to handle SE(3) constraints. We evaluated INSAT and Base-A over 50 random start and goal states in each of the diï¬€erent environment scenarios (top half of Table I). For the heuristic, we computed 3D (x, y, z) distances to the goal while accounting for obstacles and assuming a point robot. To compute it, we ran a single 3D DÄ³kstraâ€™s search backwards from the goal to obtain distances for all the cells. The results show that INSAT consistently outperforms Base-A in terms of the trajectory computation time and execution time. All the methods are timed out after 300s. The success rate shows that INSAT ï¬nds a solution in every scenario as opposed to BaseAâ€™s varying levels of reliability. Speciï¬cally, we see that the Base-A struggles when the number of windows per wall is decreased making the planner vary altitude and ï¬nd a window at diï¬€erent height to get through. This is because Base-A is a lattice search method whose performance strongly depends on parameters such as the density and the length of primitives in the lattice. While reproducing the results in their paper [8], we found that their planner used a 2.5D lattice (primitives are restricted to a single plane). Our scenario requires planning in 3D with varying altitude. Despite tuning the parameters to ï¬t 3D conï¬guration for Base-A, the exponential increase in computation combined with the discretization introduced by the lattice sacriï¬ced their success rate.

ğ‘‘x

ğ‘‘ğš¯ xË™ ğ‘šğ‘ğ‘¥ xÂ¨ ğ‘šğ‘ğ‘¥

xğ‘šğ‘ğ‘¥

ğ›¾ ğ‘“ğ‘šğ‘ğ‘¥ ğ‘‘ğ‘¡

0.2m 0.1rad 10m/s 20ğ‘š/ğ‘ 2 50ğ‘š/ğ‘ 3 500 10N 0.05s

where ğ‘‘x and dğš¯ are the linear and angular discretization used for low-dimensional search, ğ‘“ğ‘šğ‘ğ‘¥ is the maximum thrust, ğ‘‘ğ‘¡ is the time step used for collision checking and ğ›¾ is the penalty to prioritize control eï¬€ort over execution time. The execution and trackability of the generated trajectories are evaluated in Gazebo simulator . One critical parameter is the resolution of the low-dimensional grid that guarantees the plannerâ€™s completeness (refer Sec. V-C).

C. INSAT vs Sequential (S) vs Lattice Search (L) methods

S methods [6] like Base-A ï¬rst search for a path ignoring the

dynamics and then reï¬ne to ï¬nd the feasible trajectory using

trajectory optimization. L methods [8] like Base-B discretize

the entire full-dimensional space and precompute the lattice

with motion primitives oï¬„ine. INSAT ï¬nds plans with superior

behavior compared to S and L because:

Computational Complexity: L methods have fundamental

limitation as their performance signiï¬cantly depends on the

choice of discretization for the state and action space, the

primitive length along which the control input is constant

and the lattice density itself [32]. Additionally, solving the

boundary value problem to generate primitives that connect

the discrete cell centers can be diï¬ƒcult or impossible [32].

In

our

method,

albeit

X ğ‘“ ğ‘Ÿğ‘’ğ‘’
ğ¿

is

discretized,

there

is

no

such

discretization

in

Xğ‘“
ğ»

ğ‘Ÿ

ğ‘’ğ‘’
,

where

we

let

the

optimization

ï¬gure

out the continuous trajectory that minimizes the cost function

(Eq. 3). As S methods decouple planning in Xğ¿ and Xğ» ,

they cannot handle attitude constraints and is restricted to a path found in Xğ¿ when planning in Xğ» . In S, replacing the entire trajectory found in Xğ¿ with tunnel trajectory (Fig. 3)

A movie of INSAT in Gazebo simulator is available here.

8

IEEE ROBOTICS AND AUTOMATION LETTERS. PREPRINT VERSION. ACCEPTED FEBRUARY 2021

can violate the limits of velocity or jerk. Note that INSAT actively tries to minimize such violations (lines 11-14). Thus, as substantiated by our experiments, interleaving these schemes provide a superior alternative by minimizing the eï¬€ect of discretization and keeping the full dimensional search tractable.
Energy Accumulation Maneuvers: In tight spaces, a quadrotor might have to perform a periodic swing or revisit a state to accumulate energy and satisfy certain pose constraints. So a high-dimensional trajectory solution might require revisiting a low-dimensional state with a diï¬€erent value for the high-dimensional variables (i.e. same x but diï¬€erent x or x). This is handled by duplicating the low-dimensional state if it is already expanded (lines 29-30). S methods cannot handle this case as they decouple planning in Xğ¿ and Xğ» . Consequently, observe in Fig. 4 that to negotiate a window in the wall, the quadrotor actively decides to ï¬‚y in either direction relative to the window to accumulate energy such that an attitude constraint via acceleration (Eq. 5) can be satisï¬ed at the window. Another interesting behavior is the decision to ï¬‚y down or rise up helically (Fig. 4a-CENTER and Fig. 4b-CENTER) in between the tightly spaced walls in order to maintain stability or potentially avoid vortex ring states and simultaneously not reduce the speed by taking slower paths. Such a behavior leveraging the dynamic stability of the quadrotor along with the choice of windows to ï¬‚y through via global reasoning is a direct consequence of interleaving trajectory optimization with grid-based search.
VII. C
We presented INSAT, a meta algorithmic framework that interleaves trajectory optimization with graph search to generate kinodynamically feasible trajectories for aggressive quadrotor ï¬‚ight. We show that interleaving allows a ï¬‚ow of mutual information and help leverage the simplicity and global reasoning beneï¬ts of heuristic search over non-convex obstacle spaces, and mitigate the bottleneck introduced by the number of search dimensions and discretization using trajectory optimization.
The trajectory generation method and graph search algorithm can be easily replaced with alternatives depending on the application. We also analysed the completeness property of the algorithm and demonstrated it on two very diï¬€erent environments. Finally, we note that our method is not just limited to quadrotor planning and can be easily applied to other systems like ï¬xed-wing aircraft or mobile robots that have diï¬€erentially ï¬‚at representations [33]. To the best of our knowledge, INSAT is the ï¬rst to interleave graph search with trajectory optimization for robot motion planning.
R
[1] M. Cutler and J. P. How, â€œAnalysis and control of a variable-pitch quadrotor for agile ï¬‚ight,â€ J. Dyn. Sys., Meas., and Control, 2015.
[2] D. Mellinger, N. Michael, and V. Kumar, â€œTrajectory generation and control for precise aggressive maneuvers with quadrotors,â€ Int. J. Robot. Research, vol. 31, no. 5, pp. 664â€“674, 2012.
[3] M. MÃ¼ller, S. Lupashin, and R. Dâ€™Andrea, â€œQuadrocopter ball juggling,â€ in Proc. IEEE/RSJ Int. Conf. Intell. Robots Syst. IEEE, 2011, p. 5113.
[4] D. Falanga, E. Mueggler, M. Faessler, and D. Scaramuzza, â€œAggressive quadrotor ï¬‚ight through narrow gaps with onboard sensing and computing using active vision,â€ in Proc. IEEE Int. Conf. Robot. Autom. IEEE, 2017, pp. 5774â€“5781.
[5] T. Hirata and M. Kumon, â€œOptimal path planning method with attitude constraints for quadrotor helicopters,â€ in Proc. IEEE Int. Conf. Adv. Mechatronic Sys. IEEE, 2014, pp. 377â€“381.

[6] C. Richter, A. Bry, and N. Roy, â€œPolynomial trajectory planning for aggressive quadrotor ï¬‚ight in dense indoor environments,â€ in Robot. Research. Springer, 2016, pp. 649â€“666.
[7] S. M. LaValle and J. J. Kuï¬€ner Jr, â€œRandomized kinodynamic planning,â€ Int. J. Robot. Research, vol. 20, no. 5, pp. 378â€“400, 2001.
[8] S. Liu, K. Mohta, N. Atanasov, and V. Kumar, â€œSearch-based motion planning for aggressive ï¬‚ight in se (3),â€ IEEE Robot. Autom. Lett., vol. 3,
no. 3, pp. 2439â€“2446, 2018.
[9] R. Tedrake, I. R. Manchester, M. Tobenkin, and J. W. Roberts, â€œLqrtrees: Feedback motion planning via sums-of-squares veriï¬cation,â€ Int. J. Robot. Research, vol. 29, no. 8, pp. 1038â€“1052, 2010.
[10] E. A. Hansen and R. Zhou, â€œAnytime heuristic search,â€ J. Artiï¬cial Intelligence Research, vol. 28, pp. 267â€“297, 2007.
[11] M. Likhachev, G. J. Gordon, and S. Thrun, â€œAra*: Anytime a* with provable bounds on sub-optimality,â€ in Advances in neural information processing systems, 2004, pp. 767â€“774.
[12] G. Loianno, C. Brunner, G. McGrath, and V. Kumar, â€œEstimation,
control, and planning for aggressive ï¬‚ight with a small quadrotor with a single camera and imu,â€ IEEE Robot. Autom. Lett., pp. 404â€“411, 2016.
[13] M. J. Van Nieuwstadt and R. M. Murray, â€œReal-time trajectory generation for diï¬€erentially ï¬‚at systems,â€ Int. J. Robust Nonlinear Control: IFACAï¬ƒliated Journal, vol. 8, no. 11, pp. 995â€“1020, 1998.
[14] S. Liu, M. Watterson, K. Mohta, K. Sun, S. Bhattacharya, C. J. Taylor,
and V. Kumar, â€œPlanning dynamically feasible trajectories for quadrotors using safe ï¬‚ight corridors in 3-d complex environments,â€ IEEE Robot. Autom. Lett., vol. 2, no. 3, pp. 1688â€“1695, 2017.
[15] R. Deits and R. Tedrake, â€œEï¬ƒcient mixed-integer planning for uavs in cluttered environments,â€ in Proc. IEEE Int. Conf. Robot. Autom. IEEE,
2015, pp. 42â€“49.
[16] B. Landry, R. Deits, P. R. Florence, and R. Tedrake, â€œAggressive
quadrotor ï¬‚ight through cluttered environments using mixed integer programming,â€ in Proc. IEEE Int. Conf. Robot. Autom. IEEE, 2016,
pp. 1469â€“1475.
[17] S. Liu, N. Atanasov, K. Mohta, and V. Kumar, â€œSearch-based motion
planning for quadrotors using linear quadratic minimum time control,â€ in Proc. IEEE/RSJ Int. Conf. Intell. Robots Syst., 2017, pp. 2872â€“2879.
[18] K. Daniel, A. Nash, S. Koenig, and A. Felner, â€œTheta*: Any-angle path planning on grids,â€ J. Artiï¬cial Intelligence Research, vol. 39, 2010.
[19] L. E. Kavraki, P. Svestka, J.-C. Latombe, and M. H. Overmars, â€œProb-
abilistic roadmaps for path planning in high-dimensional conï¬guration spaces,â€ IEEE tran. on Robot. Autom., vol. 12, no. 4, pp. 566â€“580, 1996.
[20] S. Karaman and E. Frazzoli, â€œSampling-based algorithms for optimal motion planning,â€ Int. J. Robot. Research, vol. 30, pp. 846â€“894, 2011.
[21] D. Hsu, L. E. Kavraki, J.-C. Latombe, R. Motwani, S. Sorkin, et al.,
â€œOn ï¬nding narrow passages with probabilistic roadmap planners,â€ in Robotics: the algorithmic perspective: 1998 workshop on the algorithmic foundations of robotics, 1998, pp. 141â€“154.
[22] S. Rajasekaran, R. Natarajan, and J. D. Taylor, â€œTowards planning and control of hybrid systems with limit cycle using lqr trees,â€ in Proc. IEEE/RSJ Int. Conf. Intell. Robots Syst. IEEE, 2017, pp. 5196â€“5203.
[23] A. Majumdar and R. Tedrake, â€œFunnel libraries for real-time robust feedback motion planning,â€ Int. J. Robot. Research, pp. 947â€“982, 2017.
[24] D. Mellinger and V. Kumar, â€œMinimum snap trajectory generation and control for quadrotors,â€ in Proc. IEEE Int. Conf. Robot. Autom., 2011,
pp. 2520â€“2525.
[25] M. Hehn and R. Dâ€™Andrea, â€œQuadrocopter trajectory generation and control,â€ IFAC proceedings Volumes, vol. 44, pp. 1485â€“1491, 2011.
[26] I. D. Cowling, O. A. Yakimenko, J. F. Whidborne, and A. K. Cooke, â€œDirect method based control system for an autonomous quadrotor,â€ J. Intelligent & Robotic Systems, vol. 60, no. 2, pp. 285â€“316, 2010.
[27] M. W. Mueller, M. Hehn, and R. Dâ€™Andrea, â€œA computationally eï¬ƒcient motion primitive for quadrocopter trajectory generation,â€ IEEE Trans. Robot., vol. 31, no. 6, pp. 1294â€“1310, 2015.
[28] I. Pohl, â€œHeuristic search viewed as path ï¬nding in a graph,â€ Artiï¬cial intelligence, vol. 1, no. 3-4, pp. 193â€“204, 1970.
[29] M. Fallon, H. Johannsson, M. Kaess, and J. J. Leonard, â€œThe mit stata center dataset,â€ Int. J. Robot. Research, vol. 32, pp. 1695â€“1699, 2013.
[30] A. Technologies, â€œAscending technologies, gmbh,â€ 2012.
[31] N. Koenig and A. Howard, â€œDesign and use paradigms for gazebo, an open-source multi-robot simulator,â€ in 2004 Proc. IEEE/RSJ Int. Conf. Intell. Robots Syst., vol. 3, pp. 2149â€“2154.
[32] M. Pivtoraiko, I. A. Nesnas, and A. Kelly, â€œAutonomous robot navigation using advanced motion primitives,â€ in IEEE Aerospace Conf., 2009, pp.
1â€“7.
[33] R. M. Murray, M. Rathinam, and W. Sluis, â€œDiï¬€erential ï¬‚atness of
mechanical control systems: A catalog of prototype systems.â€ Citeseer.

