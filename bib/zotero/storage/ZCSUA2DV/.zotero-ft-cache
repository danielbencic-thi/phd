©ISTOCK PHOTO.COM/© ANDREJS ZAVADSKIS
•
By Robert Mahony, Vijay Kumar, and Peter Corke

T his article provides a tutorial introduction to modeling, estimation, and control for multirotor aerial vehicles that includes the common four-rotor or quadrotor case. Aerial robotics is a fast-growing field of robotics and multirotor aircraft, such as the quadrotor (Figure 1), are rapidly growing in popularity. In fact, quadrotor aerial robotic vehicles have become a standard platform for robotics research worldwide. They already have sufficient payload and flight endurance to support a number of indoor and outdoor applications, and the improvements of battery and other technology is rapidly increasing the scope for commercial opportunities. They are highly maneuverable and enable safe and low-cost experimentation in mapping, navigation, and control strategies for robots that move in three-dimensional (3-D) space. This ability to move in 3-D space brings new research challenges compared with the wheeled mobile robots that have driven mobile robotics research over the last decade. Small quadrotors have been demonstrated for exploring and mapping 3-D environments; transporting, manipulating, and assembling objects; and acrobatic tricks such as juggling, balancing, and flips. Additional rotors can be added, leading to generalized N-rotor vehicles, to improve payload and reliability.

Digital Object Identifier 10.1109/MRA.2012.2206474 Date of publication: 27 August 2012

Modeling, Estimation, and Control of Quadrotor

20 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012

1070-9932/12/$31.00ª2012IEEE

Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

MICHAEL SHOMIN, CMU

This tutorial describes the fundamentals of the dynamics, estimation, and control for this class of vehicle, with a bias toward electrically powered micro (less than 1 kg)-scale vehicles. The word helicopter is derived from the Greek words for spiral (screw) and wing. From a linguistic perspective, since the prefix quad is Latin, the term quadrotor is more correct than quadcopter and more common than tetracopter; hence, we use the term quadrotor throughout.

Modeling of Multirotor Vehicles The most common multirotor aerial platform, the quadrotor vehicle, is a very simple machine. It consists of four individual rotors attached to a rigid cross airframe, as shown in Figure 1. Control of a quadrotor is achieved by differential control of the thrust generated by each rotor. Pitch, roll, and heave (total thrust) control is straightforward to conceptualize. As shown in Figure 2, rotor i rotates anticlockwise (positive about the z axis) if i is even and clockwise if i is odd. Yaw control is obtained by adjusting the average speed of the clockwise and anticlockwise rotating rotors. The system is underactuated, and the remaining degrees of freedom (DoF) corresponding to the translational velocity in the x-y plane must be controlled through the system dynamics.

Rigid-Body Dynamics of the Airframe Let f~x,~y,~zg be the three coordinate axis unit vectors
without a frame of reference. Let {A} denote a right-hand
inertial frame with unit vectors along the axes denoted by f~a1,~a2,~a3g expressed in {A}. One has algebraically that~a1 ¼ ~x, ~a2 ¼ ~y, ~a3 ¼ ~z in {A}. The vector r ¼ (x, y, z) 2 fAg denotes the position of the center of mass of the vehicle.
Let {B} be a (right-hand) body fixed frame for the airframe with unit vectors f~b1,~b2,~b3g, where these vectors are the axes of frame {B} with respect to frame {A}. The orientation of the rigid body is given by a rotation matrix ARB ¼ R ¼ ½~b1,~b2,~b3 2 SO(3) in the special orthogonal group. One has ~b1 ¼ R~x, ~b2 ¼ R~y, ~b3 ¼ R~z by construction.
We will use Z-X-Y Euler angles to model this rotation,
as shown in Figure 3. To get from {A} to {B}, we first rotate
about a3 by the the yaw angle, w, and we will call this intermediary frame {E} with a basis f~e1,~e2,~e3g where ~ei is expressed with respect to frame {A}. This is followed by a
rotation about the x axis in the rotated frame through the
roll angle, /, followed by a third pitch rotation about the
new y axis through the pitch angle h that results in the body-fixed triad f~b1,~b2,~b3g

0 cwch À s/swsh
R ¼ @ chsw þ cws/sh Àc/sh

Àc/sw c/cw
s/

1 cwsh þ chs/sw swsh À cwchs/ A,
c/ch

Figure 1. A quadrotor made by Ascending Technologies with VICON markers for state estimation.

angular velocity of {B} with respect to {A}; this time expressed in {B}. Let m denote the mass of the rigid object, and I 2 R3 3 3 denote the constant inertia matrix (expressed
in the body fixed frame {B}). The rigid body equations of motion of the airframe are [2] and [3]

n_ ¼ v,

(1a)

mv_ ¼ mg~a3 þ RF,

(1b)

R_ ¼ RX 3 ,

(1c)

IX_ ¼ ÀX 3 IX þ s:

(1d)

The notation X 3 denotes the skew-symmetric matrix, such that X 3 v ¼ X 3 v for the vector cross product 3 and any vector v 2 R3. The vectors F, s 2 fBg combine the princi-
pal nonconservative forces and moments applied to the
quadrotor airframe by the aerodynamics of the rotors.

Dominant Aerodynamics The aerodynamics of rotors was extensively studied during the mid 1900s with the development of manned helicopters, and detailed models of rotor aerodynamics are available in the literature [4], [5]. Much of the detail about these aerodynamic models is useful for the design of rotor systems, where the whole range of parameters (rotor

T3 T4

T2

z
y Φi
{B} x d

T1 Front

where c and s are shorthand forms for cosine and sine, respectively.
Let v 2 fAg denote the linear velocity of {B} with respect to {A} expressed in {A}. Let X 2 fBg denote the

Figure 2. Notation for quadrotor equations of motion. N ¼ 4; Ui is a multiple of p=4 (adapted with permission from [1]).

SEPTEMBER 2012 • IEEE ROBOTICS & AUTOMATION MAGAZINE • 21
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

Z, a3 {A}
ξ O
X, a1 ψ e1

Z, b3 {B} {E }
C

y, b2

e2 ψ
Y, a2

x, b1

Figure 3. The vehicle model. The position and orientation of the robot in the global frame are denoted by n and R, respectively.

geometry, profile, hinge mechanism, and much more) are fundamental to the design problem. For a typical robotic quadrotor vehicle, the rotor design is a question for choosing one among five or six available rotors from the hobby shop, and most of the complexity of aerodynamic modeling is best ignored. Nevertheless, a basic level of aerodynamic modeling is required.
The steady-state thrust generated by a hovering rotor (i.e., a rotor that is not translating horizontally or vertically) in free air may be modeled using momentum theory [5, Sec. 2.26] as

Ti :¼ CT qAri ri2-2i ,

(2)

where, for rotor i, Ari is the rotor disk area, ri is the radius, -i is the angular velocity, CT is the thrust coefficient that depends on rotor geometry and profile, and q is the density
of air. In practice, a simple lumped parameter model

Ti ¼ cT -2i

(3)

is used, where cT > 0 is modeled as a constant that can be easily determined from static thrust tests. Identifying the thrust constant experimentally has the advantage that it will also naturally incorporate the effect of drag on the airframe induced by the rotor flow.
The reaction torque (due to rotor drag) acting on the airframe generated by a hovering rotor in free air may be modeled as [5, Sec. 2.30]

Qi :¼ cQ-2i ,

(4)

where the coefficient cQ (which also depends on Ari , ri, and q) can be determined by static thrust tests.
As a first approximation, assume that each rotor thrust is oriented in the z axis of the vehicle, although we note that this assumption does not exactly hold once the rotor begins to rotate and translate through the air, an effect that

is discussed in “Rotor Flapping.” For an N-rotor airframe, we label the rotors i 2 f1 Á Á Á Ng in an anticlockwise direction with rotor 1 lying on the positive x axis of the vehicle (the front), as shown in Figure 2. Each rotor has associated an angle Ui between its airframe support arm and the body-fixed frame x axis, and it is the distance d from the central axis of the vehicle. In addition, ri 2 fÀ1, þ1g denotes the direction of rotation of the ith rotor: þ1 corresponding to clockwise and À1 to anticlockwise. The simplest configuration is for N even and the rotors distributed symmetrically around the vehicle axis with adjacent rotors counter rotating.
The total thrust at hover (TR) applied to the airframe is the sum of the thrusts from each individual rotor

!

XN

XN

TR ¼ jTij ¼ cT

-2i :

(5)

i¼1

i¼1

The hover thrust is the primary component of the exogenous force

F ¼ TR~z þ D

(6)

in (1b), where D comprises secondary aerodynamic forces that are induced when the assumption that the rotor is in hover is violated. Since F is defined in {B}, the direction of application is written ~z, although in the frame {A} this direction is ~b3 ¼ R~z.
The net moment arising from the aerodynamics (the combination of the produced rotor forces and air resistances) applied to the N-rotor vehicle use are s ¼ (s1, s2, s3).

XN s1 ¼ cT di sin (Ui)-2i ,
i¼1

XN s2 ¼ ÀcT di cos (Ui)-2i ,
i¼1

XN

s3 ¼ cQ ri-2i :

(7)

i¼1

For a quadrotor, we can write this in matrix form

0 10

TR

cT

cT cT

cT 10 -21 1

BBBB@

s1 s2

CCCCA

¼

BBBB@

0 ÀdcT

dcT 0

0 dcT

ÀdcT 0

CCCCABBBB@

-22 -23

CCCCA,

(8)

s3

|ﬄﬄﬄﬄﬄÀﬄﬄﬄcﬄﬄQﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄcﬄQﬄﬄﬄﬄﬄ{zÀﬄﬄﬄﬄcﬄﬄQﬄﬄﬄﬄﬄﬄﬄﬄﬄﬄcﬄﬄQﬄﬄﬄﬄﬄﬄﬄﬄ} -24

C

and given the desired thrust and moments, we can solve for the required rotor speeds using the inverse of the constant matrix C. In order for the vehicle to hover, one must choose suitable -i by inverting C, such that s ¼ 0 and TR ¼ mg.

22 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

Blade Flapping and Induced Drag There are many aerodynamic and gyroscopic effects associated with any rotor craft that modify the simple force model introduced above. Most of these effects cause only minor perturbations and do not warrant consideration for a robotic system, although they are important for the design of a full-sized rotor craft. Blade flapping and induced drag, however, are fundamental effects that are of significant importance in understanding the natural stability of quadrotors and how state observers operate. These effects are particularly relevant since they induce forces in the x-y rotor plane of the quadrotor, the underactuated directions in the dynamics, that cannot be easily dominated by high gain control. In this section, we consider a single rotor and we will drop the subscript i used in the “Dominant Aerodynamics” section to refer to particular rotors.
Quadrotor vehicles are typically equipped with lightweight, fixed-pitch plastic rotors. Such rotors are not rigid, and the aerodynamic and inertial forces applied to a rotor during flight are quite significant and can cause the rotor to flex. In fact, allowing the rotor to bend is an important property of the mechanical design of a quadrotor and fitting rotors that are too rigid can lead to transmission of these aerodynamic forces directly through to the rotor hub and may result in a mechanical failure of the motor mounting or the airframe itself. Having said this, rotors on small vehicles are significantly more rigid relative to the applied aerodynamic forces than rotors on a full-scale rotor craft. Blade-flapping effects are due to the flexing of rotors, while induced drag is associated primarily with the rigidity of the rotor, and a typical quadrotor will experience both. Luckily, their mathematical expression is equivalent and a single term is sufficient to represent both effects in a lumped parameter dynamic model.
When a rotor translates laterally through the air it displays an effect known as rotor flapping (see “Rotor Flapping”). A detailed derivation of rotor flapping involves a mechanical model of the bending of the rotor subject to aerodynamic and centripetal forces as it is swept through a full rotation [5, Sec. 4.5]. The resulting equations of motion are a nonlinear second-order dynamical system with a dominant highly damped oscillatory response at the forced frequency corresponding to the angular velocity of the rotor. For a typical rotor, the flapping dynamics converge to steady state with one cycle of the rotor [5, p. 137], and for the purposes of modeling, only the steady-state response of the flapping dynamics need be considered.
Assuming that the velocity of the vehicle is directly aligned with the X axis in the inertial frame, v ¼ (vx, 0, 0), a simplified solution is given by

b

:¼

À

À 1

lA1c Á

À

1 2

l2

,

b?

:¼

À

À lA1s Á

1

þ

1 2

l2

(9)

for positive constants A1c and A1c, and where l :¼ jvxj=-r is the advance ratio, i.e., the ratio of magnitude of

the horizontal velocity of the rotor to the linear velocity of rotor tip. The flapping angle b is the steady-state tilt of the rotor away from the incoming apparent wind and b? is the tilt orthogonal to the incident wind. Here, we use equations (4.46) and (4.47) from [5, p. 138], noting that adding the effects of a virtual rotor hinge model [5, Sec. 4.7] results in additional phase lag between the sine and cosine components of the flapping angles [5, Question 4.7, p. 157] that are absorbed into the constants A1c and A1s in (9).
Rotor flapping is important because the thrust generated by the rotor is perpendicular to the rotor plane and not to the hub of the rotor. Thus, when the rotor disk tilts the rotor thrust is inclined with respect to the airframe and contains a component in the x and y directions of the body-fixed frame.
In practice the rotors are stiff and oppose the aerodynamic force which is lifting the advancing blade so that its increased thrust due to tip velocity is not fully counteracted by a lower angle of attack and lower lift coefficient—the thrust is increased. Conversely for the retreating blade the thrust is reduced. For any airfoil that generates lift (in our case the rotor blade) there is an associated induced drag
•
Rotor Flapping
When a rotor translates horizontally through the air, the advancing blade has a higher absolute tip velocity and will generate more lift than the retreating blade. Thinking of the rotor as a spinning disk, the mismatch in lift generates an overall moment on the rotor disk in the direction of the apparent wind (Figure S1). The high angular momentum of the rotor disk makes it act like a gyroscope, which causes the rotor disk to tilt around the axis given by the cross product of rotor hub axis and the torque axis, i.e., an axis that is offset from the apparent wind by 90° in the horizontal plane of the rotor. Since the motor shaft is vertical, the blade flaps up as it advances into the wind and back down again as it retreats from the apparent wind. Equilibrium is established because the advancing blade rises and decreases its angle of attack, which reduces its lift coefficient, thereby countering the additional lift that would have been generated due to its increased tip velocity. Conversely for the retreating blade, the reduced lift due to decreased tip velocity is countered by the increased angle of attack and increased thrust coefficient. In this state, the rotor will have a stable constant tilt away from the apparent wind caused by a translational motion of the rotor. This effect is known as rotor flapping and is ubiquitous in rotor vehicles [6].

TiAflapRTv

Ti Flapping Angle

Inclined Lift

β

Apparent Wind

si

Vehicle Velocity

Figure S1

SEPTEMBER 2012 • IEEE ROBOTICS & AUTOMATION MAGAZINE • 23
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

due to the backward inclination of aerodynamic force with respect to the airfoil motion. The induced drag is proportional to the lift generated by the airfoil. In normal hover conditions for a rotor, this force is equally distributed in all directions around the circumference of the rotor and is responsible for the torque Q (4). However, when there is a thrust imbalance, then the sector of the rotor travel with high thrust (for the advancing rotor) will generate more induced drag than the sector where the rotor generates less thrust (for the retreating blade). The net result will be an induced drag that opposes the direction of apparent wind as seen by the rotor, and that is proportional to the velocity of the apparent wind. This effect is often negligible for full scale rotor craft, however, it may be quite significant for small quadrotor vehicles with relatively rigid blades. The consequence of blade flapping and induced drag taken together ensures that there is always a noticeable horizontal drag experienced by a quadrotor even when maneuvering at relatively slow speeds.
We will now use the insight from the discussion above to develop a lumped parameter model for exogenous force generation (6). We assume that all four rotors are identical and rotate at similar speeds so that, at least to a first approximation, the flapping responses of the rotors and the unbalanced aerodynamic forces are the same. It follows that the reactive torques on the airframe transmitted by the rotor masts due to rotor stiffness cancel. For general motion of the vehicle, the apparent wind results in the advance ratio
qﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ l ¼ v0x2 þ v0y2=-r,

where v0 ¼ R>v is the linear velocity of the vehicle expressed in the body-fixed frame, with vx0 and vy0 being the components in the body-fixed x-y plane. Define

0

1

Aflap

¼

1 -R

@

A1c A1s 0

ÀA1s A1c 0

0 0 A, 0

where - is the set point for the rotor angular velocity. This matrix describes the sensitivities of the flapping angle to the apparent wind in the body-fixed frame, given that l is small and l2 is negligible in the denominators of (9). The first row encodes (9) for the velocity along the bodyfixed frame x axis. The second row of Aflap is a p=2 rotation of this response to account for the case where a component of the wind is incoming from the y axis, while the third row projects out velocity in the z axis of the bodyfixed frame.
We model the stiffness of the rotor as a simple torsional spring so that the induced drag is directly proportional to this angle and is scaled by the total thrust. The flapping angle is negligible with regard to the orientation of the

induced drag, and in the body-fixed frame the induced drag is

Dind:v0 % diag (dx, dy, 0)v0,
where dx ¼ dy is the induced drag coefficient. The exogenous force applied to the rotor can now be
modeled by

F :¼ TR~z À TRDv0,

(10)

where D ¼ Aflap þ diag (dx, dy, 0), and TR is the nominal thrust (5).
An important consequence of blade flapping and induced drag is a natural stability of the horizontal dynamics of the quadrotor [7]. Define





Ph :¼

1 0

00 10

(11)

to be the projection matrix onto the x-y plane. The horizontal component of a velocity expressed in {A} is

vh :¼ Phv ¼ (vx, vy)> 2 R2:

(12)

Recalling (1b) and projecting onto the horizontal component of velocity, one has

mv_h ¼ ÀTRPhð~z þ RDv0Þ:

If the vehicle is flying horizontally, i.e., vz ¼ 0, then v ¼ P>h vh and one can write

mv_h ¼ ÀTRPh~z À PhRDR>P>h vh,

(13)

where the last term introduces damping since, for a typical system, the matrix D is a positive semidefinite.
A detailed dynamic model of the quadrotor, including flapping and induced drag, is included in the robotics toolbox for MATLAB [8]. This is provided in the form of Simulink library blocks along with a set of inertial and aerodynamic parameters for a particular quadrotor. The graphical output of the animation block is shown in Figure 4. Simulink models, based on these blocks, that illustrate path following and vision-based stabilization are described in detail in [1].
The discussion provided above does not consider several additional aerodynamic effects that are important for high-speed and highly dynamic maneuvers for a quadrotor. In particular, we do not consider translational lift and drag that will effect thrust generation at high speed, axial flow modeling and vortex states that may effect thrust during axial motion, and ground effect that will affect a vehicle flying close to the ground. It should be noted that high gain control can dominate all secondary aerodynamic effects, and high

24 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

pﬃﬃ Assuming r $ d, we get - $ (1= r). Thus, Mach scaling predicts

z (Height Above Ground)

1 0.8
0.6 0.4
0.2 0 1 0.5

0

–0.5

y

–1 –1

0 –0.5
x

1 0.5

Figure 4. Frame from the Simulink animation of quadrotor dynamics.

performance control of quadrotor vehicles has been demonstrated using the simple static thrust model [23], [24]. The detailed modeling of the blade flapping and induced drag is provided due to its importance in understanding the state estimation algorithms introduced later the tutorial.

Size, Weight, and Power (SWAP) Constraints and Scaling Laws Reducing the scale of the quadrotor has an interesting effect on the inertia, payload, and ultimately the maximum achievable angular and linear acceleration. To gain insight into scaling, it is useful to develop a simple physics model to analyze a quadrotor’s ability to produce linear and angular accelerations from a hover state.
If the characteristic length is d, the rotor radius r scales linearly with d. The mass scales as d3 and the moments of inertia as d5. On the other hand, from (3) and (4), it is clear that the lift or thrust, T, and drag, Q, from the rotors scale with the square of the rotor speed, -2. In other words, T $ -2d4 and Q $ -2d4, the linear acceleration a ¼ v_, which depends on the thrust and mass, and the angular acceleration a ¼ X_ , which depends on thrust, drag, the moment arm, and the moments of inertia, scale as

a

$

-2d4 d3

¼

-2d,

a

$

-2d5 d5

¼

-2:

To explore the scaling of rotor speed with length, it is
useful to adopt the two commonly accepted approaches
to study scaling in aerial vehicles [9]. Mach scaling is
used for compressible flows and essentially assumes that
the blade tip speed, vb, is a constant leading to - $ (1=r). Froude scaling is used for incompressible
flows and assumes that, for similar aircraft configurations, the Froude number, (vb2=dg) ¼ (-2r2=dg), is constant. Here, g is the acceleration due to gravity.

a

$

1 d

,

a

$

1 d2

,

(14)

while Froude scaling leads to the conclusion

a $ 1,

a$ 1: d

(15)

Of course, Froude or Mach number similitudes take neither motor characteristics nor battery properties into account. While motor torque increases with length, the operating speed for the rotors is determined by matching the torque–speed characteristics of the motor to the drag versus speed characteristics of the rotors. Further, the motor torque depends on the ability of the battery to source the required current. All these variables are tightly coupled for smaller designs since there are fewer choices available at smaller length scales. Finally, as discussed in the previous subsection, the assumption that rotor blades are rigid may be wrong. Further, the aerodynamics of the blades may be different for blade designs optimized for smaller helicopters and the quadratic scaling of the lift with speed may not be accurate.
In spite of the simplifications in the above similitude analysis, the key insight from both Froude and Mach number similitudes is that smaller quadrotors can produce faster angular accelerations while the linear acceleration is at worst unaffected by scaling. Thus, smaller quadrotors are more agile, a fact that is easily validated from experiments conducted with the Ascending Technologies Pelican quadrotor [10] (approximately 2 kg gross weight when equipped with sensors, 0.75 m diameter, and 5,400 r/min nominal rotor speed at hover), the Ascending Technologies Hummingbird quadrotor [11] (approximately 500 g gross weight, 0.5 m diameter, and 5,000 r/min nominal rotor speed at hover), and laboratory experimental prototypes developed at GRASP laboratory at the University of Pennsylvania (approx. 75 g gross weight, 0.21 m diameter, and approximately 9,000 r/min nominal rotor speed).

Estimating the Vehicle State The key state estimates required for the control of a quadrotor are its height, attitude, angular velocity, and linear velocity. Of these states, the attitude and angular velocity are the most important as they are the primary variables used in attitude control of the vehicle. The most basic instrumentation carried by any quadrotor is an inertial measurement unit (IMU) often augmented by some form of height measurement, either acoustic, infrared, barometric, or laser based. Many robotics applications require more sophisticated sensor suites such as VICON systems, global positioning system (GPS), camera, Kinect, or scanning laser rangefinder.

SEPTEMBER 2012 • IEEE ROBOTICS & AUTOMATION MAGAZINE • 25
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

Estimating Attitude A typical IMU includes a three-axis rate gyro, three-axis accelerometer, and three-axis magnetometer. The rate gyro measures the angular velocity of {B} relative to {A} expressed in the body-fixed frame of reference {B}
XIMU ¼ X þ bX þ g 2 fBg,
where g denotes the additive measurement noise and bX denotes a constant (or slowly time-varying) gyro bias. Generally, the gyroscopes installed on quadrotor vehicles are lightweight microelectromechanical systems (MEMS) devices that are reasonably robust to noise and quite reliable.
The accelerometers (in a strap down IMU configuration) measure the instantaneous linear acceleration of {B} due to exogenous force
aIMU ¼ R>(v_ À g~z ) þ ba þ ga 2 fBg,
where ba is a bias term, ga denotes additive measurement noise, and v_ is in the inertial frame. Here, we use the notation ~z ¼ ~a3 since we will need to deal with the algebraic expressions of the coordinate axes throughout this section. Accelerometers are highly susceptible to vibration and, mounted on a quadrotor, they require significant low-pass mechanical and/or electrical filtering to be usable. Most quadrotor avionics will incorporate an analogue antialiasing filter on a MEMS accelerometer before the signal is sampled.
A commonly used technique to estimate the bias bX and ba is to average the output of these sensors for a few seconds while the quadrotor is on the ground and the motors are not yet active. The bias is then assumed constant for the duration of the flight.
The magnetometers provide measurements of the ambient magnetic field
mIMU ¼ R>Am þ Bm þ gb 2 fBg,
where Am is the Earth’s magnetic field vector (expressed in the inertial frame), Bm is a body-fixed frame expression for the local magnetic disturbance, and gb denotes the measurement noise. The noise gb is usually low for magnetometer readings; however, the local magnetic disturbance Bm can be significant, especially if the sensor is placed near the power wires to the motors.
The accelerometers and magnetometers can be used to provide absolute attitude information on the vehicle while the rate gyroscope provides complementary angular velocity measurements. The attitude information in the magnetometer signal is straightforward to understand; in the absence of noise and bias, mIMU provides a body-fixed frame measurement of R>Am and, consequently, constrains two DoF in the rotation R.
The case for using the accelerometer signal for attitude estimation is far more subtle. Using the simplest model (6)

with D  0, aIMU ¼ R>(v_ À g~z) ¼ (TR=m)~z % g~z. This shows that the measured acceleration, for this simple model, would always point in the body-fixed frame direction ~z and provides no attitude information. In practice, it is the blade-flapping component of the thrust that contributes attitude information to the accelerometer signal [7]. Recalling (10) and ignoring bias and noise terms, the model for aIMU can be written as

aIMU

¼

À

TR~z À m

TR m

DR>v:

(16)

As we show later in the section, only the low-frequency information from the accelerometer signal will be used in the observer construction. Thus, it is only the low-frequency or approximate steady-state response v of the velocity v that we need to estimate to build a model for the low-frequency component of aIMU. Setting v_ ¼ 0 in (1b), substituting for force (10), and rearranging, we obtain an estimate of the low-frequency component of the velocity signal

DR>v % R>~z À~z: Substituting DR>v for DR>v in (16), we obtain

aIMU

%

À TR m

R>~z,

(17)

where aIMU denotes the low-frequency component of the accelerometer signal. That is, the low-frequency content of aIMU when the vehicle is near hover is the body-fixed frame expression for the supporting force that is the negative gravitational vector expressed in the body-fixed frame. Most robotics applications involve a quadrotor spending significant periods of time in hover, or slow forward flight, with v_ % 0, and using the accelerometer reading as an attitude reference during this flight regime has been shown to work well in practice.
The attitude kinematics of the quadrotor are given by (1c). Let R^ denote an estimate for attitude R of the quadrotor vehicle. The following observer [12] fuses accelerometer, magnetometer, and gyroscope data as well as other direct attitude estimates RE (such as provided by a VICON or other external measurement system) should they be available:





R^_ :¼ R^ XIMU À ^b À a,

3

^b_ :¼ kba,

!

a :¼

ka g2

((R^>~z)

3

aIMU)

þ

km jAmj2

((R^>A

m)

3

mIMU

)

þ kEPso(3)ÀR^R>E Á,

3
(18)

where ka, km, kE, and kb are arbitrary nonnegative observer gains and Pso(3)(M) ¼ (M À M>)=2 is the Euclidean

26 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

matrix projection onto skew-symmetric matrices. If any one of the measurements in the innovation a are not available or unreliable, then the corresponding gain should be set to zero in the observer. Note that both the attitude R^ and the bias corrected angular velocity X^ ¼ XIMU À ^b are estimated by this observer. The observer (18) has been extensively studied in the literature [12], [13] and shown to converge exponentially (both theoretically and experimentally) to the desired attitude estimate of attitude with ^b converging to the gyroscope bias b. The filter has a complementary nature, using the high-frequency part of the gyroscope signal and the low-frequency parts of the magnetometer, accelerometer, and external attitude measurements [12]. The roll-off frequencies associated with each of these signals is given by the gains ka, km, and kE in rad.sÀ1, and good performance of the observer depends on how these gains are tuned. In particular, the accelerometer gains must be tuned to a frequency below the normal bandwidth of the vehicle motion, less than 5 rad.sÀ1 for a typical quadrotor. The magnetometer gain and external gain can be tuned for a higher roll-off frequency depending on the reliability of the signals. The bias gain kb is typically chosen an order of magnitude slower than the innovation gains kb < ka=10, leading to a rise time of the bias estimate as slow as 30 s or more. This dynamic response is necessary to track slowly varying bias and decouples the bias estimate from the attitude response; however, it is necessary to initialize the observer with a bias estimate at take off to avoid a long transient in the filter response.
A particular advantage of this observer formulation is that the gains can be adjusted in real time as long as care is taken that the bias gain is small. Adjusting the gains in real time allows one to use the accelerometer during a period when the vehicle is in hover and then set the gain ka ¼ 0 during acrobatic maneuvers when the low-frequency assumptions on aIMU no longer hold. The nonlinear robustness, guaranteed asymptotic stability, and flexibility in gain tuning make this observer a preferred candidate for quadrotor attitude estimation compared with classical filters such as the extended Kalman filter (EKF), multiplicative EKF, or more sophisticated stochastic filters.

Estimating Translational Velocity The blade-flapping response provides a way to build an observer for the horizontal velocity of the vehicle based on the IMU sensors [7], at least while the vehicle is flying in the horizontal plane. Assume that a good estimate of the vehicle attitude R^ is available and that the vehicle is flying at constant height.
Recalling the projector (11), the horizontal component of the inertial acceleration can be measured by

Aah :¼ PhAa ¼ PhRa % PhR^a,

(19)

where the signals a and R^ are available. Since we assume that the vehicle is flying at a constant height, one has

vz % 0, and recalling (12), P>h vh % v. Further, the thrust TR % mg must compensate the weight of the vehicle.
Recalling (16) and taking the horizontal component,
one has

Aah % ÀgPhR^~z À gPhR^DR>P>h vh:

(20)

Assuming that the attitude filter estimate is good, i.e., R^ ¼ R, then (19) and (20) can be solved for an estimate
of vh

vh

%

À

1 g

h Ph

R^DR^>P>h

iÀ1

ÀA

ah

þ

gPhR^~z Á:

(21)

This estimate of vh will be well defined as long as the 2 3 2 matrix PhR^DR^>P>h is invertible, a condition that will hold as long as the vehicle pitches or rolls by less than 90° during flight.
Equation (21) provides a measurement of the horizontal velocity; however, since it directly incorporates the unfiltered accelerometer readings, it is generally too noisy to be of much use. Its low-frequency content can, however, be used to drive a velocity complementary observer that uses the attitude estimate and the system model (1b) along with the thrust model (10) for its high-frequency component. Let ^vh be an estimate of the horizontal component of the inertial velocity of the vehicle. Recalling (1b), we propose the following observer





^v_h ¼ ÀgP>h R^~z þ R^DR^>P>h ^vh À kw(^vh À vh), (22)

where vh is given by (21). The gain kw > 0 provides a tuning parameter that adjusts the roll-off frequency for the information from ^vh that is used in the filter. It also uses an estimated velocity ^vh to provide an approximation of the more correct RDR>P>h vh term in the feedforward velocity estimate; however, since the underlying dynamics associated with this term are stable, the observer is stable even with this approximation.
Estimating Position The final part of state that must be estimated is position, which is typically considered separately as position in the plane and height. Considering the height first, there are in fact two separate heights that are of importance: the first is the absolute height of the vehicle and the second is the relative height over the terrain at a given time. Unfortunately, there is no effective way to use the IMU to estimate absolute height; at best, some low-frequency information from the z axis of the accelerometer provides limited information about vertical motion. Most quadrotors include a barometric sensor that can resolve absolute height to a few centimeters. Absolute height can also be estimated using GPS, VICON, or a full SLAM system. Relative height can be estimated using acoustic, laser-ranging or infrared

SEPTEMBER 2012 • IEEE ROBOTICS & AUTOMATION MAGAZINE • 27
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

sensors. Once a sufficiently accurate height measurement complexity, control latency, and the susceptibility to inter-

is available, it is better to use this directly in the control ference and dropouts. However, processor speed continues

than add additional levels of complexity in designing a to improve, and we can also utilize the vision and control

height observer, especially since, for a typical system, the techniques used by flying insects that perform complex

only feedforward information available is the noisy accel- tasks with very limited sensing and neural capability [21].

erometer readings.

Second, there is an ambiguity between certain rotational

Position in the plane can also be determined in a rela- and translational motions, particularly, when a narrow

tive or absolute way. Absolute position can be obtained field of view perspective camera is used. Third, the under-

from a GPS (few-centimeter accuracy at up to 10 Hz [6]) actuated quadrotor uses the roll and pitch DoF to point the

or an external localization device such as a VICON thrust vector in the direction of the desired translational

motion capture system (50 lm accuracy at 375 Hz). How- motion. For a camera that is rigidly attached to the quadro-

ever, a GPS does not work indoors and motion-capture tor, this attitude control motion induces a large apparent

systems are expensive, and their sensor array has a motion in the image. It is therefore necessary to estimate

limited spatial extent that is impractical to scale up for vehicle attitude at the instant the image was captured by

large indoor environments.

the sensor to eliminate this effect. Biological systems face

Relative position can be estimated by measuring the dis- similar problems, and interestingly, mammals and insects

tance to objects in the environment from onboard sensors, have developed similar solutions: gyroscopic sensors

typically small onboard laser range finders (LRFs) or (the vestibular sensors of the inner ear and the halteres,

RGBD camera systems such as the Kinect. Well-known respectively) [22]. Finally, there exists a problem with

SLAM techniques, borrowing LRF-based techniques recovering motion scale when using a single camera. Stereo

similar to those developed for mobile ground robots over is possible, but the baseline is constrained, particularly as

the last decade, have been applied to quadrotors [14]. vehicles get smaller.

However, LRFs provide only a cross section of the 3-D

environment and this scan plane tilts as the vehicle maneu- Control

vers, resulting in apparent changes to the distance of walls, The control problem, to track smooth trajectories and, in extreme cases, the scan plane can intersect the floor ðRÃ(t), nÃ(t)Þ 2 SE(3), is challenging for several reasons.

or ceiling. LRFs are heavy and power hungry, which pre- First, the system is underactuated: there are four inputs vents their application to the next generation of much u ¼ (TR, s>)>, while SE(3) is six dimensional. Second, the

smaller quadcopters.

aerodynamic model described above is only approximate.

Vision has the advantage that the sensor is small, light- Finally, the inputs are themselves idealized. In practice, the

weight, and low power, which will become increasingly motor controllers must overcome the drag moments to

important as the size of aerial vehicles decreases. Vision generate the required speeds and realize the input thrust

can provide essential navigational competencies such as (TR) and moments (s). The dynamics of the motors and

odometry, attitude estimation, mapping, place and object their interactions with the drag forces on the propellers

recognition, and collision detection. There is a long history can be difficult to model, although first-order linear mod-

of applying vision to aerial robotic systems [15]–[19] for els are a useful approximation.

indoor and outdoor environments, and the well-known A hierarchical control approach is common for quadro-

Parrot AR.Drone game device makes strong use of vision tors. The lowest level, the highest bandwidth, is in control

for attitude and odometry [20]. Vision can also be used for of the rotor rotational speed. The next level is in control of

object recognition based on color, texture, and shape, as vehicle attitude, and the top level is in control of position

well as collision avoidance.

along a trajectory. These levels form nested feedback loops,

Vision is not without its challenges. First, vision is com- as shown in Figure 5.

putationally intense and can result in a low sample rate.

Since onboard computational power is limited (by SWAP Controlling the Motors

consumption), most reported systems transmit the images Rotor speed drives the dynamic model of the vehicle

wirelessly to a ground station, which increases system according to (8), so high-quality control of the motor

speed is fundamentally important

for overall control of the vehicle;

ξ* Trajectory

Position

u1

Motor

Planner ψ* Controller

R* Attitude

Controller

Controller u2

Attitude

Planner

R,Ω

ξ,v

Rigid Body Dynamics

high bandwidth control of the thrust TR, denoted by u1, and the torques (sx, sy, sz), denoted by u2, lead to high performance attitude and position control. Most quadro-

tor vehicles are equipped with

Figure 5. The innermost motor control loop, the intermediate attitude control loop, and the outer position control loop.

brushless dc motors that use back electromotive force (EMF) sensing

28 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

for rotor commutation and high-frequency pulsewidth modulation (PWM) to control motor voltage. The simplest systems generally use a direct voltage control of the motors since steady-state motor speed is proportional to voltage; however; the dynamic response is second-order due to the mechanical and electrical dynamics. Improved performance is obtained by incorporating single-input single-output control at the motor/rotor level

Vi ¼ k(-Ãi À -i) þ Vff (-Ãi ),

(23)

rotation ARE(w) and ERB(/, h), which is a composition of the roll and pitch, we can linearize the rotation about (w, /, h) ¼ (w0, 0, 0)

ARB ¼ ARE(w0 þ Dw) ERB(D/, Dh)

0 cos w ¼ BBB@ sin w

À sin w cos w

Dh cos w þ D/ sin w 1 Dh sin w À D/ cos w CCCA,

ÀDh D/

1

where Vi is the applied motor voltage, -Ãi is the desired speed, and the actual motor speed -i can be measured from the electronic commutation in the embedded speed controller. This can help to overcome a common problem where the rotor speed for a given PWM command setting will decrease as the battery voltage reduces during flight. The significant load torque due to aerodynamic drag will lead to a tracking error that can be minimized by high proportional gain (k) and/or a feedforward term. A positive benefit of the drag torque is that the system is heavily damped, which precludes the need for derivative control. The feedforward term Vff (-Ãi ) compensates for the steady-state PWM associated with a given velocity set point by incorporating the best available thrust model determined using static thrust tests and possibly including battery voltage.
The performance of the motor controllers is ultimately limited by the current that can be supplied from the batteries. This may be a significant limiting factor for smaller vehicles. Overly aggressive tuning and extreme maneuvers may cause the voltage bus to drop excessively, reducing the thrust from other rotors and, in extreme cases, causing the onboard electronics to brownout. For this reason, it is common to introduce a saturation, although this destroys the linearity of the motor/rotor response during aggressive maneuvers.

Attitude Control We first consider the design of an exponentially converging controller in SO(3). Given a desired airframe attitude R?, we want to first develop a measure of the error in rotations. We choose the measure

eR 3

¼

1

À(RÃ)TR

À

RT

RÃ

Á ,

2

(24)

which yields a skew-symmetric matrix representing the axis of rotation required to go from R to RÃ and whose
magnitude is equal to the sine of the angle of rotation.
To derive linear controllers, we linearize the dynamics
about the nominal hover position at which the roll (/) and
pitch (h) are close to zero and the angular velocities are close to zero. If we write R ¼ ARB as a product of the yaw

where w ¼ w0 þ Dw. If R? ¼ ARB(w0 þ Dw, D/, Dh) and R ¼ ARB(w0, 0, 0), (24) gives

0 0 Dw ÀDh 1

eR3 ¼ BB@ ÀDw

0

D/ CCA,

(25)

Dh ÀD/ 0

which, as we expect, corresponds to the error vector

eR ¼ (D/, Dh, Dw)>,
with components in the body-fixed frame. If the desired angular velocity vector is zero, we can compute the proportional and derivative error to obtain the PD control law

u2 ¼ ÀkReR À kXeX,

(26)

where kR and kX are positive definite gain matrices. This controller guarantees stability for small deviations from the hover position.
To obtain convergence for larger deviations from the hover position, it is necessary to revert back to (24) without linearization. This allows us to directly compute the error on SO(3). By compensating for the nonlinear inertial terms and by including the correct error term, we obtain
u2¼J(ÀkReRÀkXeX)þX 3 JXÀJ(X 3 RT R?X?ÀRT R?X_ ?):
(27)

This controller is guaranteed to be exponentially stable for almost any rotation [23]. From a practical standpoint, it is possible to neglect the last three terms in the controller and achieve satisfactory performance, but the correct calculation of the error term is important [24].

Trajectory Control
We now turn our attention to the control of the trajectory along a specified trajectory n?(t). As before, we
first consider linear controllers by linearizing the dynamics about n ¼ n?(t), h ¼ / ¼ 0, w ¼ w?(t), n_ ¼ 0, and

SEPTEMBER 2012 • IEEE ROBOTICS & AUTOMATION MAGAZINE • 29
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

/_ ¼ h_ ¼ w_ ¼ 0, with the nominal input given by inputs as functions of the outputs (n, w) and their derivatives.

u1 ¼ mg, u2 ¼ 0. Linearizing (1a), we get

Derivatives of n yield the velocity v and the acceleration,

n€1 ¼ g(Dh cos w? þ D/ sin w?),

n€2 ¼ g(Dh sin w? À D/ cos w?),

n€3

¼

1 m

u1

À

g:

(28)

To exponentially drive all three components of error, we want to command the acceleration vector n€com to satisfy

(n€Ã(t) À n€com) þ Kd(n_Ã(t) À n_) þ Kp(nÃ(t) À n) ¼ 0:

From (28), we can immediately write





u1 ¼ m g þ n€Ã3 þ kd, z(n_Ã3 À n_3) þ kp, z(nÃ3 À n3) , (29)

to guarantee (n3(t) À n?3(t)) ! 0. Similarly, for the other
two components, we choose to command the appropriate h? and /? to guarantee exponential convergence

/?

¼

1 g

(n€c1om

sin

w?(t)

À

n€c2om

cos

w?(t)),

h?

¼

1 g

(n€c1om

cos

w?(t)

þ

n€c2om

sin

w?(t)),

(30a) (30b)

where the above equations are obtained by replacing Dh by h? and D/ by /? in (28). Finally, (w?, /?, h?) are provided as set points to the attitude controller discussed in the previous section. Thus, as shown in Figure 5, the control problem is addressed by decoupling the position control and attitude control subproblems, and the position control loop provides the attitude set points for the attitude controller.
The position controller can also be obtained without linearization. This is done by projecting the position error (and its derivatives) along b3 and applying the input u1 that cancels the gravitational force and provides the appropriate proportional plus derivative feedback

u1

¼

m~bT3 n€Ã

þ

Kd (n_Ã

À

n_)

þ

Kp(nÃ

À

n)

þ

 g~a3 :

(31)

Note that the projection operation is a nonlinear function of the roll and pitch angles, and, thus, this is a nonlinear controller. In [23], it is shown that the two nonlinear controllers (27) and (31) result in exponential stability and allow the robot to track trajectories in SE(3).

Trajectory Planning The quadrotor is underactuated, and this makes it difficult to plan trajectories in 12-dimensional state space (6 DoF position and velocity). However, the problem is considerably simplified if we use the fact that the quadrotor dynamics are differentially flat [25]. To see this, we consider the output position n and the yaw angle w. We show that we can write all state variables and

v_

¼

1 m

u1~b3

þ

g~a3:

From Figure 3 we see that

~e1 ¼ ½cos w, sin w, 0T,
and the unit vectors for the body-fixed frame can be written in terms of the variables w and v_ as

~b3

¼

v_ kv_

À À

g~a3 g~a3k

,

~b2

¼

~~bb33

33~~ee11

,

~b1

¼

~b2

3 ~b3

provided ~b3 3~e1 ¼6 0. This defines the rotation matrix ARB as a function of v_ (the second derivative of n) and w. In this way,

we write the angular velocity and the four inputs as functions

of position, velocity, acceleration, jerk (c), and snap, or the

derivative of jerk (r). From these equations, it is possible to ver-

ify that there is a diffeomorphism between the 18 3 1 vector

 nT,

vT,

aT,

cT,

rT,

wT,

w_ T,

w€T

and

R

3

 nT,

n_T,

XT,

u1,

u_ 1,

u€1

,

uT2 T

:

This property of differential flatness makes it easy to design trajectories that respect the dynamics of the underactuated system. Any four-times-differentiable trajectory in the space of flat outputs, (n>(t), w(t))>, corresponds to a feasible trajectory—one that satisfies the equations of motion. All inequality constraints of states and inputs can be expressed as functions of the flat outputs and their derivatives. This mapping to the space of flat outputs can be used to generate trajectories that minimize a cost functional formed by a weighted combination of the different flat outputs and their derivatives:

min

Z

T

L(n,

n_,

€n,

ÁÁÁ
n,

ÁÁÁÁ
n w,

w_ ,

w€ )dt ,

n(t), w(t) 0

g(n(t), w(t)) 0:

(32)

In [24], minimum snap trajectories were generated by minimizing a cost functional derived from the snap and the angular yaw acceleration with

L(n,

n_,

€n,

ÁÁÁ
n,

ÁÁÁÁ
n w,

w_ ,

w€)

¼

(1

À

c)(

ÁÁÁÁ
n

)4

þ

c(w€)2:

By suitable parameterizing trajectories with basis functions in the flat space and by considering linear inequalities in the flat

30 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

space to model constraints on states and inputs (e.g., u1 ! 0), it is possible to turn this optimization into a quadratic program that can be solved in real time for planning.
Finally, as shown in [11], it is possible to combine this controller with attitude-only controllers to fly through vertical windows or land on inclined perches with close to zero normal velocity. A trajectory controller is used by the robot to build up momentum, while the attitude controller enables reorientation while coasting with the generated momentum.

Vision-Based Perception and Control There are two approaches to the question of controlling an aerial vehicle based on visual information. The first is to use classical robotic SLAM techniques, although with the caveat that the environment and state estimation are inherently 3-D. There are many researchers currently working on this problem, and we will not attempt to discuss this approach further, except to say that should a good-quality environmental estimation and localization algorithm be developed, the control techniques discussed above can be applied. The second approach is direct sensor-based control [26], the most commonly referred to case, being that of image-based visual servo control [27]–[29].
The motion of a point in an image is a function of its coordinate (u, v) and the camera motion



u_ v_

¼ J(u, v, Z)m,

(33)

where Z is the point depth, m ¼ (vx, vy, vz, xx, xy, xz)> is the spatial velocity of the camera (and vehicle), and J( Á ) is the visual Jacobian or interaction matrix. J can be formulated for a perspective camera [30], where (u, v) are pixel coordinates; or a spherical camera [31] where (u, v) are latitude and longitude angles.
The pitch and roll motion of the vehicle are controlled by the attitude subsystem to maintain a position or to follow a path in space, and this causes image motion. We partition the equations as





u_ v_

¼ J1(u, v)(vx, vy, vz, xz)> þ J2(u, v)

xx xy

,

(34)

where the right-most term describes the image motion due to the exogenous roll and pitch motion. Rearranging we can write



u_ 0 v_ 0



¼



u_ v_

>

À

J2(u,

 v)

xx xy



(35)

¼ J1(u, v)(vx, vy, vz, xz)>,

(36)

Now consider a point in the image (u0i, vi0) and its desired location in the image (uÃi , viÃ). This desired position might come from a snapshot of the scene taken when the
vehicle was at the desired pose that we wish to return to. The desired image motion is therefore (u_ Ãi , v_iÃ) ¼ k(uÃi É u0i, viÃ É vi0), where the operator É represents the difference on image plane or sphere. For N points, we
can write

00 kBBBBBBBBB@BBBBBBBBB@

u_ Ã1 v_ 1Ã ... u_ ÃN

1 CCCCCCCCCA

À

0 BBB@

J1(u1, ...
J1(uN ,

v1) vN )

1 CCCA

1

xx xy

!CCCCCCCCCA

v_ NÃ

¼

0 BBB@

J2(u1, ...

v1)

10 CCCABBBBB@

vx vy vz

1 CCCCCA:

(37)

|ﬄﬄﬄJﬄﬄ2ﬄﬄ(ﬄuﬄﬄ{Nz,ﬄvﬄﬄNﬄﬄﬄ)ﬄﬄﬄﬄ} xz

B

If N > 2 and the matrix B is nonsingular, we can solve for the required translational and yaw velocity to move the vehicle to a pose where the feature points have the desired image coordinates (uÃi , viÃ). The desired velocity is input to a control system as discussed earlier. This is an example of image-based visual servoing for an underactuated vehicle, and the technique can be applied to a wider variety of problems, such as holding station, path following, obstacle avoidance, and landing.

Conclusions In this article, we have provided a tutorial introduction to modeling, estimation, and control for multirotor aerial vehicles, with a particular focus on the most common form—the quadrotor. The dynamic model includes the rigid body motion of the vehicle in SE(3), the simple aerodynamics associated with hover, and the extension to the case of forward motion where blade flapping becomes important. State estimation based on accelerometers, gyroscopes, and magnetometers was discussed for attitude and translational velocity, and GPS, motion-capture systems, and cameras for position estimation. A hierarchy of control techniques was discussed, from the individual rotors through attitude control, aggressive trajectory following, and image-based visual control. The future possibilities of highly agile small-scale vehicles were laid with a discussion on dimensional scaling for which vision will be an important sensing modality.

where (u0, v0) represent image points for which the roll and pitch motion has been removed based on the knowledge of xx and xy, which can be obtained from gyroscopes.

Acknowledgment This research was partly supported by the Australian Research Council through Future Fellowship FT0991771,

SEPTEMBER 2012 • IEEE ROBOTICS & AUTOMATION MAGAZINE • 31
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

Foundations of Vision Based Control of Robotic Vehicles, the U.S. Army Research Laboratory Grant W911NF-08-20004, and the U.S. Office of Naval Research Grants N00014-07-1-0829, N00014-09-1-1051, and N00014-081-0696.
References
[1] P. I. Corke, Robotics, Vision & Control: Fundamental Algorithms in MATLAB. Berlin: Springer-Verlag, 2011. [2] T. Hamel, R. Mahony, R. Lozano, and J. Ostrowski, “Dynamic modelling and configuration stabilization for an X4-flyer,” in Proc. Int. Federation of Automatic Control Symp. (IFAC), 2002, p. 6. [3] S. Bouabdallah, P. Murrieri, and R. Siegwart, “Design and control of an indoor micro quadrotor,” in Proc. IEEE Int. Conf. Robotics and Automation (ICRA), Apr. 26–May 1, 2004, vol. 5, pp. 4393–4398. [4] R. W. Prouty, Helicopter Performance, Stability and Control. Melbourne, FL: Krieger, 1995 (reprint with additions, original edition 1986). [5] J. Leishman. (2000). Principles of Helicopter Aerodynamics (Cambridge Aerospace Series). Cambridge, MA: Cambridge Univ. Press. [Online]. Available: http://books.google.com.au/books?id=nMV-TkaX-9cC [6] H. Huang, G. Hoffmann, S. Waslander, and C. Tomlin, “Aerodynamics and control of autonomous quadrotor helicopters in aggressive maneuvering,” in Proc. IEEE Int. Conf. Robotics and Automation (ICRA), May 2009, pp. 3277–3282. [7] P. Martin and E. Salaun, “The true role of accelerometer feedback in quadrotor control,” in Proc. IEEE Int. Conf. Robotics and Automation, Anchorage, AK, May 2010, pp. 1623–1629. [8] P. Corke. Robotics toolbox for MATLAB. (2012). [Online]. Available: http://www.petercorke.com/robot. [9] C. H. Wolowicz, J. S. Bowman, and W. P. Gilbert, “Similitude requirements and scaling relationships as applied to model testing,” NASA, Tech. Rep. 1435, Aug. 1979. [10] S. Shen, N. Michael, and V. Kumar, “3D estimation and control for autonomous flight with constrained computation,” in Proc. IEEE Int. Conf. Robotics and Automation, Shanghai, China, May 2011, p. 6. [11] D. Mellinger, N. Michael, and V. Kumar, “Trajectory generation and control for precise aggressive maneuvers with quadrotors,” Int. J. Robot. Res., vol. 31, no. 5, pp. 664–674, Apr. 2012. [12] R. Mahony, T. Hamel, and J.-M. Pflimlin, “Non-linear complementary filters on the special orthogonal group,” IEEE Trans. Automat. Contr., vol. 53, no. 5, pp. 1203–1218, June 2008. [13] S. Bonnabel, P. Martin, and P. Rouchon, “Non-linear symmetry-preserving observers on lie groups,” IEEE Trans. Automat. Contr., vol. 54, no. 7, pp. 1709–1713, 2009. [14] A. Bachrach, S. Prentice, R. He, and N. Roy, “Range-robust autonomous navigation in GPS-denied environments,” J. Field Robot., vol. 28, no. 5, pp. 644–666, 2011. [15] O. Amidi, T. Kanade, and R. Miller, “Vision-based autonomous helicopter research at Carnegie Mellon Robotics Institute,” in Proc. Heli Japan, 1998, vol. 98, p. 6. [16] P. Corke, “An inertial and visual sensing system for a small autonomous helicopter,” J. Robot. Syst., vol. 21, no. 2, pp. 43–51, Feb. 2004. [17] L. Meier, P. Tanskanen, F. Fraundorfer, and M. Pollefeys, “Pixhawk: A system for autonomous flight using onboard computer,” in Proc. ICRA, 2011, p. 6.

[18] C. Kemp, “Visual control of a miniature quad rotor helicopter,” Ph.D. dissertation, Univ. Cambridge, Cambridge, U.K., 2006. [19] M. Achtelik, A. Bachrach, R. He, S. Prentice, and N. Roy, “Stereo vision and laser odometry for autonomous helicopters in GPS-denied indoor environments,” in Proc. SPIE Unmanned Systems Technology XI. Orlando, FL, SPIE, 2009, vol. 7332, p. 10. [20] P. Bristeau, F. Callou, D. Vissiere, and N. Petit, “The navigation and control technology inside the AR. drone micro UAV,” in Proc. World Congress, 2011, vol. 18, no. 1, pp. 1477–1484. [21] V. Srinivasan and S. Venkatesh, From Living Eyes to Seeing Machines. London, U.K.: Oxford Univ. Press, 1997. [22] P. Corke, J. Lobo, and J. Dias, “An introduction to inertial and visual sensing,” Int. J. Robot. Res., vol. 26, no. 6, pp. 519–536, June 2007. [23] T. Lee, M. Leok, and N. McClamroch, “Geometric tracking control of a quadrotor UAV on SE(3),” in Proc. IEEE Conf. Decision and Control, 2010, p. 6. [24] D. Mellinger and V. Kumar, “Minimum snap trajectory generation and control for quadrotors,” in Proc. Int. Conf. Robotics and Automation (ICRA), Shanghai, China, May 2011, p. 6. [25] M. J. V. Nieuwstadt and R. M. Murray, “Real-time trajectory generation for differentially flat systems,” Int. J. Robust and Nonlinear Control, vol. 8, no. 11, pp. 995–1020, 1998. [26] C. Samson, M. Le Borgne, and B. Espiau, Robot Control: The Task Function Approach (The Oxford Engineering Science Series). Oxford, U.K.: Oxford Univ. Press, 1991. [27] T. Hamel and R. Mahony, “Visual servoing of an under-actuated dynamic rigid-body system: An image based approach,” IEEE Trans. Robot. Automat., vol. 18, no. 2, pp. 187–198, Apr. 2002. [28] N. Guenard, T. Hamel, and R. Mahony, “A practical visual servo control for a unmanned aerial vehicle,” IEEE Trans. Robot., vol. 24, no. 2, pp. 331–341, Apr. 2008. [29] R. Mahony, P. Corke, and T. Hamel, “Dynamic image-based visual servo control using centroid and optic flow features,” J. Dynamic. Syst., Meas. Contr., vol. 130, no. 1, p. 12, Jan. 2008. [30] S. Hutchinson, G. Hager, and P. Corke, “A tutorial on visual servo control,” IEEE Trans. Robot. Autom., vol. 12, no. 5, pp. 651–670, Oct. 1996. [31] P. I. Corke, “Spherical image-based visual servo and structure estimation,” in Proc. IEEE Int. Conf. Robotics and Automation, Anchorage, AK, May 2010, pp. 5550–5555.
Robert Mahony, Research School of Engineering, Australian National University, Canberra 0200, Australia. E-mail: Robert.Mahony@anu.edu.au.
Vijay Kumar, Department of Mechanical Engineering and Applied Mechanics, GRASP Laboratory, University of Pennsylvania, Philadelphia, USA. E-mail: vijay.kumar@ grasp.upenn.edu.
Peter Corke, School of Electrical Engineering and Computer Science, Queensland University of Technology, Australia. E-mail: Peter.Corke@qut.edu.au.

32 • IEEE ROBOTICS & AUTOMATION MAGAZINE • SEPTEMBER 2012
Authorized licensed use limited to: IEEE Xplore. Downloaded on April 20,2022 at 12:16:04 UTC from IEEE Xplore. Restrictions apply.

